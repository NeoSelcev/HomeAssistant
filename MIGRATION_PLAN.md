# –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏–∑ AdGuard –≤ HomeAssistant

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 19 –æ–∫—Ç—è–±—Ä—è 2025  
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: 21 –æ–∫—Ç—è–±—Ä—è 2025  
**–ò—Å—Ç–æ—á–Ω–∏–∫**: AdGuard –ø—Ä–æ–µ–∫—Ç (Raspberry Pi 3B+)  
**–¶–µ–ª—å**: HomeAssistant –ø—Ä–æ–µ–∫—Ç (Dell Wyse 3040)  
**–ü–µ—Ä–∏–æ–¥**: 13 –∫–æ–º–º–∏—Ç–æ–≤ (5-21 –æ–∫—Ç—è–±—Ä—è 2025)

---

## üéØ –¶–µ–ª—å –º–∏–≥—Ä–∞—Ü–∏–∏

–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤—Å–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, –¥–æ–±–∞–≤–∏—Ç—å Cloudflare Tunnel –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ Home Assistant —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç, –≤–Ω–µ–¥—Ä–∏—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–∏—Å—Ç–µ–º—É —É–º–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –∑–∞–≥—Ä—É–∑–∫–µ.

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–ª–∞–Ω–∞

### ‚úÖ **–ß—Ç–æ –ø–µ—Ä–µ–Ω–æ—Å–∏–º** (–ø—Ä–∏–º–µ–Ω–∏–º–æ –∫ –æ–±–æ–∏–º –ø—Ä–æ–µ–∫—Ç–∞–º)
### üîß **–ß—Ç–æ –∞–¥–∞–ø—Ç–∏—Ä—É–µ–º** (—Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ–¥ Dell Wyse)
### üÜï **–ß—Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º** (–Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å)
### ‚ùå **–ß—Ç–æ –ù–ï –ø–µ—Ä–µ–Ω–æ—Å–∏–º** (—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ –¥–ª—è AdGuard)

---

## ‚ö†Ô∏è –í–ê–ñ–ù–û: –ù–æ–≤—ã–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (21 –æ–∫—Ç—è–±—Ä—è 2025)

**–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ 2 –Ω–æ–≤—ã—Ö –∫–æ–º–º–∏—Ç–∞**, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –ü–ï–†–í–´–ú–ò:

### üî¥ –ö–æ–º–º–∏—Ç #1 (4603bb8, 21 –æ–∫—Ç 06:31): –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫–æ–ª–ª–∏–∑–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ logging-service.sh
- –î–æ–±–∞–≤–ª–µ–Ω—ã wrapper-—Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –±–∞–≥ —Å sudo –≤ ha-watchdog.sh
- –£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ ha-failure-notifier.sh
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ 7 —Å–µ—Ä–≤–∏—Å–∞—Ö

### üî¥ –ö–æ–º–º–∏—Ç #2 (6fb7813, 21 –æ–∫—Ç 07:51): Systemd timers + Boot notifier
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ systemd timer –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —É–º–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –∑–∞–≥—Ä—É–∑–∫–µ
- –†–∞–∑–ª–∏—á–∞–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ/–Ω–µ–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏

**–≠—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±—É–¥—É—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –≤ –≠–¢–ê–ü–ï 0 (–Ω–æ–≤—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π —ç—Ç–∞–ø –ø–µ—Ä–µ–¥ –≤—Å–µ–º–∏ –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏)**

**–≠—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±—É–¥—É—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –≤ –≠–¢–ê–ü–ï 0 (–Ω–æ–≤—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π —ç—Ç–∞–ø –ø–µ—Ä–µ–¥ –≤—Å–µ–º–∏ –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏)**

---

## üìã –≠–¢–ê–ü 0: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ò –¶–ï–ù–¢–†–ê–õ–ò–ó–û–í–ê–ù–ù–û–ï –õ–û–ì–ò–†–û–í–ê–ù–ò–ï ‚ö†Ô∏èüî¥

**–ü–†–ò–û–†–ò–¢–ï–¢: –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–´–ô - –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ü–ï–†–í–´–ú –ø–µ—Ä–µ–¥ –≤—Å–µ–º–∏ –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ —ç—Ç–∞–ø–∞–º–∏**

**–ò—Å—Ç–æ—á–Ω–∏–∫**: –ö–æ–º–º–∏—Ç—ã `4603bb8` (21 –æ–∫—Ç, 06:31) –∏ `6fb7813` (21 –æ–∫—Ç, 07:51)

### 0.1 –ò—Å–ø—Ä–∞–≤–∏—Ç—å logging-service.sh (–ö–†–ò–¢–ò–ß–ù–û)

**–ü—Ä–æ–±–ª–µ–º–∞ #1: –ö–æ–ª–ª–∏–∑–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö**
- –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `CONFIG_FILE` –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç —Å –¥—Ä—É–≥–∏–º–∏ —Å–∫—Ä–∏–ø—Ç–∞–º–∏
- –í—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –ø—Ä–∏ source'–µ –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏—Ö —Å–∫—Ä–∏–ø—Ç–∞—Ö

**–ü—Ä–æ–±–ª–µ–º–∞ #2: Exit 1 —É–±–∏–≤–∞–µ—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ —Å–∫—Ä–∏–ø—Ç—ã**
- –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∫–æ–Ω—Ñ–∏–≥–∞ `exit 1` –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å
- –°–µ—Ä–≤–∏—Å—ã –ø–µ—Ä–µ—Å—Ç–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

**–§–∞–π–ª**: `services/system/logging-service/logging-service.sh`

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ 1 - –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å CONFIG_FILE**:
```bash
# –ë–´–õ–û (—Å—Ç—Ä–æ–∫–∞ 6):
CONFIG_FILE="/etc/logging-service/config"

# –°–¢–ê–õ–û:
LOGGING_CONFIG_FILE="/etc/logging-service/config"
```

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ 2 - –°–¥–µ–ª–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º**:
```bash
# –ë–´–õ–û (—Å—Ç—Ä–æ–∫–∏ 8-14):
# Load configuration
if [[ -f "$CONFIG_FILE" ]]; then
    source "$CONFIG_FILE"
else
    echo "$(date '+%Y-%m-%d %H:%M:%S') [ERROR] Config file not found: $CONFIG_FILE" >&2
    exit 1  # ‚ùå –£–ë–ò–í–ê–ï–¢ –†–û–î–ò–¢–ï–õ–¨–°–ö–ò–ô –°–ö–†–ò–ü–¢!
fi

# Default values
LOG_FORMAT="${LOG_FORMAT:-plain}"

# –°–¢–ê–õ–û:
# Load configuration (optional - use defaults if not found)
if [[ -f "$LOGGING_CONFIG_FILE" ]]; then
    source "$LOGGING_CONFIG_FILE"
fi

# Default values (if not set in config)
LOG_FORMAT="${LOG_FORMAT:-plain}"
```

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ 3 - –î–æ–±–∞–≤–∏—Ç—å wrapper-—Ñ—É–Ω–∫—Ü–∏–∏** (–≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞, –ø–æ—Å–ª–µ —Ñ—É–Ω–∫—Ü–∏–∏ `log_with_metrics`):
```bash
# ========================================
# Convenience wrapper functions for common use
# ========================================

# These functions should be used when sourced by other scripts
# They don't require passing service name repeatedly

log_debug() {
    local message="$1"
    local service="${SCRIPT_NAME:-unknown}"
    log_structured "$service" "DEBUG" "$message"
}

log_info() {
    local message="$1"
    local service="${SCRIPT_NAME:-unknown}"
    log_structured "$service" "INFO" "$message"
}

log_warn() {
    local message="$1"
    local service="${SCRIPT_NAME:-unknown}"
    log_structured "$service" "WARN" "$message"
}

log_error() {
    local message="$1"
    local service="${SCRIPT_NAME:-unknown}"
    log_structured "$service" "ERROR" "$message"
}

log_critical() {
    local message="$1"
    local service="${SCRIPT_NAME:-unknown}"
    log_structured "$service" "CRITICAL" "$message"
}
```

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ 4 - –û–±–Ω–æ–≤–∏—Ç—å –≤–µ—Ä—Å–∏—é** (—Å—Ç—Ä–æ–∫–∞ 6):
```bash
# –ë–´–õ–û:
# Version: 1.0

# –°–¢–ê–õ–û:
# Version: 1.1 - Fixed CONFIG_FILE name collision
```

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ 5 - –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –º–∞–ø–ø–∏–Ω–≥–∏ –ª–æ–≥-—Ñ–∞–π–ª–æ–≤** (–≤ —Ñ—É–Ω–∫—Ü–∏–∏ `get_log_file()`):

–ù–∞–π—Ç–∏ —Ñ—É–Ω–∫—Ü–∏—é `get_log_file()` –∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ case statement:
```bash
get_log_file() {
    local service_name="$1"
    
    # Map service names to log files
    case "$service_name" in
        "ha-watchdog") echo "/var/log/ha-watchdog.log" ;;
        "ha-failure-notifier") echo "/var/log/ha-failure-notifier.log" ;;
        "telegram-sender") echo "/var/log/telegram-sender.log" ;;
        "nightly-reboot") echo "/var/log/ha-reboot.log" ;;
        "update-checker") echo "/var/log/update-checker.log" ;;
        "logging-service") echo "/var/log/logging-service.log" ;;
        # üÜï –ù–û–í–´–ï –ú–ê–ü–ü–ò–ù–ì–ò (–¥–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö):
        "system-diagnostic-startup") echo "/var/log/system-diagnostic-startup.log" ;;
        "ha-backup") echo "/var/log/ha-backup.log" ;;
        "boot-notifier") echo "/var/log/boot-notifier.log" ;;
        *) echo "/var/log/system.log" ;;
    esac
}
```

**–ò—Å—Ç–æ—á–Ω–∏–∫**: –ö–æ–º–º–∏—Ç `4603bb8` (–∏–∑–º–µ–Ω–µ–Ω–∏—è 1-4) –∏ `6fb7813` (–∏–∑–º–µ–Ω–µ–Ω–∏–µ 5)

---

### 0.2 –ò—Å–ø—Ä–∞–≤–∏—Ç—å ha-watchdog.sh - –î–æ–±–∞–≤–∏—Ç—å sudo –¥–ª—è fail2ban (–ö–†–ò–¢–ò–ß–ù–û)

**–ü—Ä–æ–±–ª–µ–º–∞**: 
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `ag` –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `fail2ban-client status sshd`
- Watchdog –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç false positive –æ—à–∏–±–∫–∏

**–§–∞–π–ª**: `services/monitoring/ha-watchdog/ha-watchdog.sh`

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ 1 - –î–æ–±–∞–≤–∏—Ç—å SCRIPT_NAME** (–ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ —Å LOGGING_SERVICE, –æ–∫–æ–ª–æ —Å—Ç—Ä–æ–∫–∏ 32):
```bash
# Centralized logging ONLY through logging-service
LOGGING_SERVICE="/usr/local/bin/logging-service.sh"
SCRIPT_NAME="ha-watchdog"  # üÜï –î–û–ë–ê–í–ò–¢–¨ –≠–¢–£ –°–¢–†–û–ö–£
```

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ 2 - –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è** (—É–¥–∞–ª–∏—Ç—å ~25 —Å—Ç—Ä–æ–∫):

–ù–∞–π—Ç–∏ –∏ **–£–î–ê–õ–ò–¢–¨** —Å–ª–µ–¥—É—é—â–∏–π –±–ª–æ–∫ (–æ–∫–æ–ª–æ —Å—Ç—Ä–æ–∫ 47-74):
```bash
# ‚ùå –£–î–ê–õ–ò–¢–¨ –í–ï–°–¨ –≠–¢–û–¢ –ë–õ–û–ö:
log() {
    local level=$1
    local message=$2
    # Use centralized logging with correct parameter order: service, level, message, extra_data
    log_structured "ha-watchdog" "$level" "$message"
}

log_debug() {
    log "DEBUG" "$1"
}

log_info() {
    log "INFO" "$1"
}

log_error() {
    log "ERROR" "$1"
}

log_warn() {
    log "WARN" "$1"
}
# ‚ùå –ö–û–ù–ï–¶ –£–î–ê–õ–Ø–ï–ú–û–ì–û –ë–õ–û–ö–ê
```

**–ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π**:
```bash
# Note: log_debug, log_info, log_warn, log_error are now provided by logging-service.sh
```

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ 3 - –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É wrapper-—Ñ—É–Ω–∫—Ü–∏–π** (–ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ log_structured, –æ–∫–æ–ª–æ —Å—Ç—Ä–æ–∫–∏ 42):
```bash
if [[ -f "$LOGGING_SERVICE" ]] && [[ -r "$LOGGING_SERVICE" ]]; then
    if source "$LOGGING_SERVICE" 2>/dev/null; then
        if ! command -v log_structured >/dev/null 2>&1; then
            echo "$(date '+%Y-%m-%d %H:%M:%S') [ERROR] [ha-watchdog] [PID:$$] [systemd] logging-service loaded, but log_structured function is not available" >> "$LOG_FILE"
            exit 1
        fi
        # üÜï –î–û–ë–ê–í–ò–¢–¨ –ü–†–û–í–ï–†–ö–£ WRAPPER-–§–£–ù–ö–¶–ò–ô:
        if ! command -v log_debug >/dev/null 2>&1; then
            echo "$(date '+%Y-%m-%d %H:%M:%S') [ERROR] [ha-watchdog] [PID:$$] [systemd] logging-service loaded, but log_debug function is not available" >> "$LOG_FILE"
            exit 1
        fi
    else
        echo "$(date '+%Y-%m-%d %H:%M:%S') [ERROR] [ha-watchdog] [PID:$$] [systemd] Failed to source logging-service" >> "$LOG_FILE"
        exit 1
    fi
else
    echo "$(date '+%Y-%m-%d %H:%M:%S') [ERROR] [ha-watchdog] [PID:$$] [systemd] Centralized logging-service not found: $LOGGING_SERVICE" >> "$LOG_FILE"
    exit 1
fi
```

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ 4 - –î–æ–±–∞–≤–∏—Ç—å sudo –∫ fail2ban-client** (–≤ —Ñ—É–Ω–∫—Ü–∏–∏ `check_ssh_security()`, –æ–∫–æ–ª–æ —Å—Ç—Ä–æ–∫–∏ 213-227):

–ù–∞–π—Ç–∏:
```bash
# Check if SSH jail is enabled
if ! fail2ban-client status sshd &>/dev/null; then
```

–ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞:
```bash
# Check if SSH jail is enabled (requires sudo)
if ! sudo fail2ban-client status sshd &>/dev/null; then
```

**–¢–†–ï–ë–£–ï–¢–°–Ø –ù–ê–°–¢–†–û–ô–ö–ê PERMISSIONS** (—Å–º. —Ä–∞–∑–¥–µ–ª 0.9)

**–ò—Å—Ç–æ—á–Ω–∏–∫**: –ö–æ–º–º–∏—Ç `4603bb8`

---

### 0.3 –£–ª—É—á—à–∏—Ç—å ha-failure-notifier.sh

**–§–∞–π–ª**: `services/monitoring/ha-failure-notifier/ha-failure-notifier.sh`

**–î–æ–±–∞–≤–ª—è–µ–º–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**:
1. ‚úÖ –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Ä—É—á–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (exit code 0)
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
3. ‚úÖ Throttling —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π CONTAINER_DOWN (10 –º–∏–Ω—É—Ç)
4. ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ lowercase –∏ –¥–µ—Ñ–∏—Å–æ–≤ –≤ —Ç–∏–ø–∞—Ö —Å–æ–±—ã—Ç–∏–π
5. ‚úÖ Batch processing summary

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ 1 - –£–ª—É—á—à–∏—Ç—å regex –¥–ª—è —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π** (—Ñ—É–Ω–∫—Ü–∏—è `parse_event_line`, –æ–∫–æ–ª–æ —Å—Ç—Ä–æ–∫–∏ 80):

–ù–∞–π—Ç–∏:
```bash
if [[ "$message" =~ ^([A-Z_]+):(.*)$ ]]; then
```

–ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞:
```bash
# Support uppercase, lowercase, and hyphens in event types
if [[ "$message" =~ ^([A-Za-z_-]+):(.*)$ ]]; then
```

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ 2 - –î–æ–±–∞–≤–∏—Ç—å –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Ä—É—á–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏** (–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π, –æ–∫–æ–ª–æ —Å—Ç—Ä–æ–∫–∏ 150):

–ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ exit code, –¥–æ–±–∞–≤–∏—Ç—å:
```bash
# Detect manual container stop (exit code 0 = graceful shutdown)
if [[ "$exit_code" == "0" ]]; then
    log_info "Container ${container_name} stopped gracefully (exit code 0) - likely manual stop, skipping notification"
    return
fi
```

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ 3 - –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞** (–ø–æ—Å–ª–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è CONTAINER_DOWN):
```bash
handle_container_down() {
    local container_name="$1"
    local exit_code="$2"
    
    log_warn "Container DOWN detected: ${container_name} (exit code: ${exit_code})"
    
    # Wait 5 seconds and check if container restarted
    sleep 5
    
    local current_status=$(docker inspect --format='{{.State.Status}}' "$container_name" 2>/dev/null)
    if [[ "$current_status" == "running" ]]; then
        log_info "Container ${container_name} successfully restarted, no notification needed"
        return
    fi
    
    # Container still down, check throttling
    local current_time=$(date +%s)
    local last_notification_file="/tmp/ha-failure-notifier-${container_name}-down.timestamp"
    
    if [[ -f "$last_notification_file" ]]; then
        local last_notification=$(cat "$last_notification_file")
        local time_diff=$((current_time - last_notification))
        
        # Throttle: only notify once per 10 minutes
        if [[ $time_diff -lt 600 ]]; then
            log_info "Throttling CONTAINER_DOWN notification for ${container_name} (last: ${time_diff}s ago)"
            return
        fi
    fi
    
    # Send notification and update timestamp
    send_notification "üî¥ Container DOWN: ${container_name}" "Exit code: ${exit_code}"
    echo "$current_time" > "$last_notification_file"
}
```

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ 4 - –î–æ–±–∞–≤–∏—Ç—å batch summary** (–≤ –∫–æ–Ω—Ü–µ –≥–ª–∞–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏):
```bash
# At the end of processing multiple events
if [[ $total_events -gt 5 ]]; then
    log_info "Batch processing complete: $total_events events processed ($success_count success, $failure_count failures)"
fi
```

**–ò—Å—Ç–æ—á–Ω–∏–∫**: –ö–æ–º–º–∏—Ç `4603bb8`

---

### 0.4 –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ telegram-sender.sh

**–§–∞–π–ª**: `services/communication/telegram-sender/telegram-sender.sh`

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ 1 - –î–æ–±–∞–≤–∏—Ç—å SCRIPT_NAME** (–≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞, –ø–æ—Å–ª–µ shebang):
```bash
#!/bin/bash
# Telegram Notification Sender
# Version: 2.0 - Integrated with centralized logging

SCRIPT_NAME="telegram-sender"  # üÜï –î–û–ë–ê–í–ò–¢–¨
```

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ 2 - –ü–æ–¥–∫–ª—é—á–∏—Ç—å logging-service**:
```bash
# üÜï –î–û–ë–ê–í–ò–¢–¨ –ë–õ–û–ö:
LOGGING_SERVICE="/usr/local/bin/logging-service.sh"
if [[ -f "$LOGGING_SERVICE" ]] && [[ -r "$LOGGING_SERVICE" ]]; then
    source "$LOGGING_SERVICE" 2>/dev/null
    if ! command -v log_info >/dev/null 2>&1; then
        echo "ERROR: logging-service wrapper functions not available" >&2
        exit 1
    fi
else
    echo "ERROR: Centralized logging-service not found: $LOGGING_SERVICE" >&2
    exit 1
fi
```

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ 3 - –£–¥–∞–ª–∏—Ç—å custom log_message()** (–Ω–∞–π—Ç–∏ –∏ —É–¥–∞–ª–∏—Ç—å ~15 —Å—Ç—Ä–æ–∫):

–ù–∞–π—Ç–∏ –∏ **–£–î–ê–õ–ò–¢–¨**:
```bash
# ‚ùå –£–î–ê–õ–ò–¢–¨:
log_message() {
    local level="$1"
    local message="$2"
    local caller="${3:-${FUNCNAME[1]}}"
    
    echo "$(date '+%Y-%m-%d %H:%M:%S') [$level] [telegram-sender] [PID:$$] [$caller] $message" | tee -a "$LOG_FILE"
}
```

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ 4 - –ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ –≤—ã–∑–æ–≤—ã log_message**:

–ù–∞–π—Ç–∏ –≤—Å–µ:
```bash
log_message "INFO" "..."
log_message "ERROR" "..."
log_message "WARN" "..."
```

–ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞:
```bash
log_info "..."
log_error "..."
log_warn "..."
```

**–ò—Å—Ç–æ—á–Ω–∏–∫**: –ö–æ–º–º–∏—Ç `4603bb8`

---

### 0.5 –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

#### 0.5.1 ha-backup.sh

**–§–∞–π–ª**: `services/system/ha-backup/ha-backup.sh`

**–î–æ–±–∞–≤–∏—Ç—å –≤ –Ω–∞—á–∞–ª–æ —Å–∫—Ä–∏–ø—Ç–∞** (–ø–æ—Å–ª–µ shebang –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤):
```bash
SCRIPT_NAME="ha-backup"

LOGGING_SERVICE="/usr/local/bin/logging-service.sh"
if [[ -f "$LOGGING_SERVICE" ]]; then
    source "$LOGGING_SERVICE" 2>/dev/null
fi
```

**–ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ –≤—ã–∑–æ–≤—ã echo –Ω–∞ log_info/log_error**:
```bash
# –ë—ã–ª–æ:
echo "Starting backup..."

# –°—Ç–∞–ª–æ:
log_info "Starting backup..."
```

#### 0.5.2 nightly-reboot.sh

**–§–∞–π–ª**: `services/system/nightly-reboot/nightly-reboot.sh`

**–î–æ–±–∞–≤–∏—Ç—å –≤ –Ω–∞—á–∞–ª–æ**:
```bash
SCRIPT_NAME="nightly-reboot"

LOGGING_SERVICE="/usr/local/bin/logging-service.sh"
if [[ -f "$LOGGING_SERVICE" ]]; then
    source "$LOGGING_SERVICE" 2>/dev/null
fi
```

#### 0.5.3 update-checker.sh

**–§–∞–π–ª**: `services/system/update-checker/update-checker.sh`

**–î–æ–±–∞–≤–∏—Ç—å –≤ –Ω–∞—á–∞–ª–æ**:
```bash
SCRIPT_NAME="update-checker"

LOGGING_SERVICE="/usr/local/bin/logging-service.sh"
if [[ -f "$LOGGING_SERVICE" ]]; then
    source "$LOGGING_SERVICE" 2>/dev/null
fi
```

#### 0.5.4 system-diagnostic-startup.sh

**–§–∞–π–ª**: `services/system/system-diagnostic-startup/system-diagnostic-startup.sh`

**–ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–ø–∏—Å–∫–∞ —Å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º**:

```bash
#!/bin/bash
SCRIPT_NAME="system-diagnostic-startup"

LOGGING_SERVICE="/usr/local/bin/logging-service.sh"
if [[ -f "$LOGGING_SERVICE" ]] && [[ -r "$LOGGING_SERVICE" ]]; then
    source "$LOGGING_SERVICE" 2>/dev/null
    if ! command -v log_info >/dev/null 2>&1; then
        echo "ERROR: logging-service not available" >&2
        exit 1
    fi
else
    echo "ERROR: Centralized logging-service not found" >&2
    exit 1
fi

log_info "System diagnostic at startup - BEGIN"

# Run diagnostic
/root/HomeAssistant/services/diagnostics/system-diagnostic.sh

log_info "System diagnostic at startup - COMPLETE"
```

#### 0.5.5 system-diagnostic.sh

**–§–∞–π–ª**: `services/diagnostics/system-diagnostic.sh`

**–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É wrapper-—Ñ—É–Ω–∫—Ü–∏–π** (–ø–æ—Å–ª–µ source logging-service):
```bash
if [[ -f "$LOGGING_SERVICE" ]]; then
    source "$LOGGING_SERVICE" 2>/dev/null
    # üÜï –î–û–ë–ê–í–ò–¢–¨ –ü–†–û–í–ï–†–ö–£:
    if command -v log_info >/dev/null 2>&1; then
        USE_CENTRALIZED_LOGGING=true
    fi
fi
```

**–ò—Å—Ç–æ—á–Ω–∏–∫**: –ö–æ–º–º–∏—Ç `4603bb8`

---

### 0.6 –ò—Å–ø—Ä–∞–≤–∏—Ç—å systemd timer –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (–ö–†–ò–¢–ò–ß–ù–û)

**–ü—Ä–æ–±–ª–µ–º–∞**: 
Calendar-based —Ç–∞–π–º–µ—Ä—ã **–∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –¥–≤–∞–∂–¥—ã**:
1. –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–∏—Å—Ç–µ–º—ã (–∏–∑-–∑–∞ `Requires=` –¥–∏—Ä–µ–∫—Ç–∏–≤—ã)
2. –í –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è

**–†–µ—à–µ–Ω–∏–µ**: –£–¥–∞–ª–∏—Ç—å `Requires=`, `RandomizedDelaySec`, –∏–∑–º–µ–Ω–∏—Ç—å `Persistent` –¥–ª—è calendar-based —Ç–∞–π–º–µ—Ä–æ–≤

#### 0.6.1 ha-backup.timer

**–§–∞–π–ª**: `services/system/ha-backup/ha-backup.timer`

**–ò–∑–º–µ–Ω–∏—Ç—å**:
```ini
# –ë–´–õ–û:
[Unit]
Description=Raspberry Pi System Backup Timer
Documentation=man:systemd.timer(5)
Requires=ha-backup.service  # ‚ùå –£–î–ê–õ–ò–¢–¨

[Timer]
# Run daily at 2:00 AM (before nightly reboot at 3:30 AM)
OnCalendar=*-*-* 02:00:00
Persistent=false
RandomizedDelaySec=300  # ‚ùå –£–î–ê–õ–ò–¢–¨

[Install]
WantedBy=timers.target

# –°–¢–ê–õ–û:
[Unit]
Description=Raspberry Pi System Backup Timer
Documentation=man:systemd.timer(5)

[Timer]
# Run daily at 2:00 AM (before nightly reboot at 3:30 AM)
OnCalendar=*-*-* 02:00:00
Persistent=false

[Install]
WantedBy=timers.target
```

#### 0.6.2 update-checker.timer

**–§–∞–π–ª**: `services/system/update-checker/update-checker.timer`

**–ò–∑–º–µ–Ω–∏—Ç—å**:
```ini
# –ë–´–õ–û:
[Unit]
Description=Run HA Update Checker on weekdays at 09:00
Requires=update-checker.service  # ‚ùå –£–î–ê–õ–ò–¢–¨

[Timer]
OnCalendar=Mon..Fri 09:00
RandomizedDelaySec=1800  # ‚ùå –£–î–ê–õ–ò–¢–¨
Persistent=true  # ‚ùå –ò–ó–ú–ï–ù–ò–¢–¨

[Install]
WantedBy=timers.target

# –°–¢–ê–õ–û:
[Unit]
Description=Run HA Update Checker on weekdays at 09:00

[Timer]
OnCalendar=Mon..Fri 09:00
Persistent=false

[Install]
WantedBy=timers.target
```

#### 0.6.3 system-diagnostic-startup.timer

**–§–∞–π–ª**: `services/system/system-diagnostic-startup/system-diagnostic-startup.timer`

**–ò–∑–º–µ–Ω–∏—Ç—å**:
```ini
# –ë–´–õ–û:
[Unit]
Description=Run system diagnostic at startup (05:30)
Requires=system-diagnostic-startup.service  # ‚ùå –£–î–ê–õ–ò–¢–¨

[Timer]
OnCalendar=*-*-* 05:30:00
Persistent=true  # ‚ùå –ò–ó–ú–ï–ù–ò–¢–¨
RandomizedDelaySec=60  # ‚ùå –£–î–ê–õ–ò–¢–¨

[Install]
WantedBy=timers.target

# –°–¢–ê–õ–û:
[Unit]
Description=Run system diagnostic at startup (05:30)

[Timer]
OnCalendar=*-*-* 05:30:00
Persistent=false

[Install]
WantedBy=timers.target
```

#### 0.6.4 nightly-reboot.timer

**–§–∞–π–ª**: `services/system/nightly-reboot/nightly-reboot.timer`

**–ò–∑–º–µ–Ω–∏—Ç—å**:
```ini
# –ë–´–õ–û:
[Unit]
Description=Nightly system reboot at 03:30
Requires=nightly-reboot.service  # ‚ùå –£–î–ê–õ–ò–¢–¨

[Timer]
OnCalendar=*-*-* 03:30:00
Persistent=false

[Install]
WantedBy=timers.target

# –°–¢–ê–õ–û:
[Unit]
Description=Nightly system reboot at 03:30

[Timer]
OnCalendar=*-*-* 03:30:00
Persistent=false

[Install]
WantedBy=timers.target
```

**–ò—Å—Ç–æ—á–Ω–∏–∫**: –ö–æ–º–º–∏—Ç `6fb7813`

---

### 0.7 –î–æ–±–∞–≤–∏—Ç—å Boot Notification System üÜï

**–¶–µ–ª—å**: –†–∞–∑–ª–∏—á–∞—Ç—å –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ (nightly-reboot) –∏ –Ω–µ–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏

**–õ–æ–≥–∏–∫–∞**:
- üü¢ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ ‚Üí **–ë–ï–ó —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** (–æ–Ω–æ —É–∂–µ –±—ã–ª–æ –ø–µ—Ä–µ–¥ reboot)
- üî¥ –ù–µ–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ ‚Üí **–° —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º** –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π

#### 0.7.1 –°–æ–∑–¥–∞—Ç—å boot-notifier.sh

**–§–∞–π–ª**: `services/system/boot-notifier/boot-notifier.sh`

**–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ñ–∞–π–ª**:
```bash
#!/bin/bash
# Boot Notification Script
# Sends Telegram notification after system boot
# Detects if reboot was planned (nightly-reboot) or unplanned

SCRIPT_NAME="boot-notifier"
LOGGING_SERVICE="/usr/local/bin/logging-service.sh"
TELEGRAM_SENDER="/usr/local/bin/telegram-sender.sh"
REBOOT_LOG="/var/log/ha-reboot.log"
PLANNED_REBOOT_MARKER="/var/lib/nightly-reboot/planned-reboot.marker"

# Connect centralized logging service
if [[ -f "$LOGGING_SERVICE" ]] && [[ -r "$LOGGING_SERVICE" ]]; then
    source "$LOGGING_SERVICE" 2>/dev/null
    if ! command -v log_structured >/dev/null 2>&1; then
        echo "ERROR: logging-service not available" >&2
        exit 1
    fi
else
    echo "ERROR: Centralized logging-service not found: $LOGGING_SERVICE" >&2
    exit 1
fi

# Wait for system to stabilize
sleep 10

# Check if this was a planned reboot
PLANNED_REBOOT=false
if [[ -f "$PLANNED_REBOOT_MARKER" ]]; then
    # Check if marker is recent (less than 5 minutes old)
    MARKER_AGE=$(($(date +%s) - $(stat -c %Y "$PLANNED_REBOOT_MARKER" 2>/dev/null || echo 0)))
    if [[ $MARKER_AGE -lt 300 ]]; then
        PLANNED_REBOOT=true
        log_info "Detected planned reboot (marker age: ${MARKER_AGE}s)"
        # Remove marker after detection
        rm -f "$PLANNED_REBOOT_MARKER"
    else
        log_warn "Found old reboot marker (age: ${MARKER_AGE}s), considering reboot unplanned"
        rm -f "$PLANNED_REBOOT_MARKER"
    fi
fi

# If planned reboot, exit silently (notification already sent before reboot)
if [[ "$PLANNED_REBOOT" == "true" ]]; then
    log_info "Planned reboot detected - skipping notification"
    exit 0
fi

# UNPLANNED REBOOT - Collect diagnostics
log_warn "Unplanned reboot detected - collecting diagnostics"

BOOT_TIME=$(uptime -s)
UPTIME=$(uptime -p)
LOAD_AVG=$(cat /proc/loadavg | awk '{print $1, $2, $3}')
MEM_TOTAL=$(free -h | grep Mem | awk '{print $2}')
MEM_USED=$(free -h | grep Mem | awk '{print $3}')
MEM_FREE=$(free -h | grep Mem | awk '{print $4}')
DISK_USAGE=$(df -h / | tail -1 | awk '{print $5}')
DISK_FREE=$(df -h / | tail -1 | awk '{print $4}')

# Check for kernel panic in current boot
KERNEL_PANIC=$(journalctl -b -p err 2>/dev/null | grep -i "kernel panic" | tail -5)
if [[ -z "$KERNEL_PANIC" ]]; then
    KERNEL_PANIC="None detected"
fi

# Check for power supply issues
POWER_ISSUES=$(dmesg 2>/dev/null | grep -i "power supply" | tail -5)
if [[ -z "$POWER_ISSUES" ]]; then
    POWER_ISSUES="None detected"
fi

# Get last shutdown reason
SHUTDOWN_REASON=$(journalctl -b -1 -p warning 2>/dev/null | grep -i "shutdown\|reboot" | tail -3)
if [[ -z "$SHUTDOWN_REASON" ]]; then
    SHUTDOWN_REASON="Unknown (no logs from previous boot)"
fi

# Build notification message
MESSAGE="‚ö†Ô∏è UNPLANNED SYSTEM REBOOT DETECTED

üïê Boot Time: $BOOT_TIME
‚è±Ô∏è Uptime: $UPTIME
üìä Load Average: $LOAD_AVG

üíæ Memory:
   Total: $MEM_TOTAL
   Used: $MEM_USED
   Free: $MEM_FREE

üíø Disk:
   Usage: $DISK_USAGE
   Free: $DISK_FREE

üîç DIAGNOSTICS:

üß® Kernel Panic:
$KERNEL_PANIC

‚ö° Power Issues:
$POWER_ISSUES

üìù Last Shutdown Reason:
$SHUTDOWN_REASON

---
System: Dell Wyse 3040 (HomeAssistant)
Time: $(date '+%Y-%m-%d %H:%M:%S')"

# Send notification
log_info "Sending unplanned reboot notification"
if "$TELEGRAM_SENDER" "$MESSAGE" "0"; then
    log_info "Notification sent successfully"
else
    log_error "Failed to send notification"
fi

# Log to reboot log
echo "$(date '+%Y-%m-%d %H:%M:%S') - UNPLANNED REBOOT DETECTED" >> "$REBOOT_LOG"
echo "  Boot time: $BOOT_TIME" >> "$REBOOT_LOG"
echo "  Load: $LOAD_AVG" >> "$REBOOT_LOG"
echo "---" >> "$REBOOT_LOG"
```

**–ü—Ä–∞–≤–∞**: `chmod +x services/system/boot-notifier/boot-notifier.sh`

#### 0.7.2 –°–æ–∑–¥–∞—Ç—å boot-notifier.service

**–§–∞–π–ª**: `services/system/boot-notifier/boot-notifier.service`

```ini
[Unit]
Description=Boot Notification Service
Documentation=https://github.com/YourRepo/HomeAssistant
After=network-online.target
Wants=network-online.target

[Service]
Type=oneshot
User=root
ExecStart=/usr/local/bin/boot-notifier.sh
StandardOutput=journal
StandardError=journal
TimeoutStartSec=120

[Install]
WantedBy=multi-user.target
```

#### 0.7.3 –°–æ–∑–¥–∞—Ç—å boot-notifier.timer

**–§–∞–π–ª**: `services/system/boot-notifier/boot-notifier.timer`

```ini
[Unit]
Description=Boot Notification Timer
Documentation=https://github.com/YourRepo/HomeAssistant
Requires=boot-notifier.service

[Timer]
# Run 30 seconds after boot
OnBootSec=30s
AccuracySec=1s

[Install]
WantedBy=timers.target
```

**–í–ê–ñ–ù–û**: –≠—Ç–æ **interval timer** (OnBootSec), –ø–æ—ç—Ç–æ–º—É **–î–û–õ–ñ–ï–ù** –∏–º–µ—Ç—å `Requires=`

#### 0.7.4 –°–æ–∑–¥–∞—Ç—å boot-notifier.logrotate

**–§–∞–π–ª**: `services/system/boot-notifier/boot-notifier.logrotate`

```
/var/log/boot-notifier.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0640 root root
}
```

#### 0.7.5 –û–±–Ω–æ–≤–∏—Ç—å nightly-reboot.sh

**–§–∞–π–ª**: `services/system/nightly-reboot/nightly-reboot.sh`

**–î–æ–±–∞–≤–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–∞** (–ü–ï–†–ï–î –æ—Ç–ø—Ä–∞–≤–∫–æ–π —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ reboot):

```bash
#!/bin/bash
SCRIPT_NAME="nightly-reboot"

# ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...

# üÜï –î–û–ë–ê–í–ò–¢–¨ –°–û–ó–î–ê–ù–ò–ï –ú–ê–†–ö–ï–†–ê:
# Create planned reboot marker for boot-notifier
MARKER_DIR="/var/lib/nightly-reboot"
MARKER_FILE="$MARKER_DIR/planned-reboot.marker"

mkdir -p "$MARKER_DIR"
touch "$MARKER_FILE"
log_info "Created planned reboot marker: $MARKER_FILE"

# Send notification
"$TELEGRAM_SENDER" "üîÑ Nightly system reboot starting..." "0"

# Wait and reboot
sleep 5
systemctl reboot
```

**–ò—Å—Ç–æ—á–Ω–∏–∫**: –ö–æ–º–º–∏—Ç `6fb7813`

---

### 0.8 –û–±–Ω–æ–≤–∏—Ç—å ag-monitoring-control.sh

**–§–∞–π–ª**: `services/management/ag-monitoring-control.sh`

**–î–æ–±–∞–≤–∏—Ç—å boot-notifier –≤–æ –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**:

**–í –º–∞—Å—Å–∏–≤ —Å–µ—Ä–≤–∏—Å–æ–≤** (–æ–∫–æ–ª–æ —Å—Ç—Ä–æ–∫–∏ 10):
```bash
# –ë–´–õ–û:
SERVICES=(
    "ha-watchdog.timer"
    "ha-failure-notifier.timer"
    "update-checker.timer"
    "system-diagnostic-startup.timer"
    "nightly-reboot.timer"
    "ha-backup.timer"
)

# –°–¢–ê–õ–û:
SERVICES=(
    "ha-watchdog.timer"
    "ha-failure-notifier.timer"
    "update-checker.timer"
    "system-diagnostic-startup.timer"
    "nightly-reboot.timer"
    "ha-backup.timer"
    "boot-notifier.timer"  # üÜï –î–û–ë–ê–í–ò–¢–¨
)
```

**–í —Ñ—É–Ω–∫—Ü–∏–∏ logs** (–¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ª–æ–≥-—Ñ–∞–π–ª):
```bash
logs() {
    echo "=== Monitoring Service Logs ==="
    echo ""
    echo "--- ha-watchdog ---"
    tail -20 /var/log/ha-watchdog.log 2>/dev/null || echo "No logs"
    echo ""
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ª–æ–≥–∏ ...
    echo "--- boot-notifier ---"  # üÜï –î–û–ë–ê–í–ò–¢–¨
    tail -20 /var/log/boot-notifier.log 2>/dev/null || echo "No logs"
}
```

**–ò—Å—Ç–æ—á–Ω–∏–∫**: –ö–æ–º–º–∏—Ç `6fb7813`

---

### 0.9 –ù–∞—Å—Ç—Ä–æ–∏—Ç—å permissions (–ö–†–ò–¢–ò–ß–ù–û)

**–¢—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–∞–≤–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `ag`**:

#### 0.9.1 Docker group

**–ö–æ–º–∞–Ω–¥–∞**:
```bash
sudo usermod -aG docker ag
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞**:
```bash
groups ag | grep docker
```

#### 0.9.2 Fail2ban sudoers

**–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª**: `/etc/sudoers.d/ag-fail2ban`

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ**:
```
# Allow ag user to check fail2ban status without password
ag ALL=(ALL) NOPASSWD: /usr/bin/fail2ban-client status*
```

**–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∞**:
```bash
sudo chmod 0440 /etc/sudoers.d/ag-fail2ban
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞**:
```bash
sudo -u ag sudo fail2ban-client status
```

#### 0.9.3 –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø—É docker –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã:
```bash
sudo systemctl daemon-reload
sudo systemctl restart ha-watchdog.timer
sudo systemctl restart ha-failure-notifier.timer
```

**–ò–ª–∏ –ø–µ—Ä–µ–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º ag**:
```bash
su - ag
```

**–ò—Å—Ç–æ—á–Ω–∏–∫**: –ö–æ–º–º–∏—Ç `4603bb8` (install_plan.md)

---

### 0.10 –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

#### 0.10.1 README.md

**–î–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ü–∏—é "Centralized Logging Architecture"** (–ø–æ—Å–ª–µ —Å–µ–∫—Ü–∏–∏ "Services"):

```markdown
## üìù Centralized Logging Architecture

All monitoring services use a unified logging system via `logging-service.sh`.

### Log Format

```
YYYY-MM-DD HH:MM:SS [LEVEL] [service-name] [PID:12345] [caller-function] message
```

### Log Levels

- `DEBUG` - Detailed diagnostic information
- `INFO` - General informational messages
- `WARN` - Warning messages (non-critical issues)
- `ERROR` - Error messages (failures, but service continues)
- `CRITICAL` - Critical failures (service may stop)

### Wrapper Functions

Scripts source `logging-service.sh` and use convenience wrappers:

```bash
SCRIPT_NAME="my-service"
source /usr/local/bin/logging-service.sh

log_debug "Detailed debug info"
log_info "Normal operation message"
log_warn "Warning about something"
log_error "Error occurred"
log_critical "Critical failure"
```

### Integrated Services

- ‚úÖ ha-watchdog
- ‚úÖ ha-failure-notifier
- ‚úÖ telegram-sender
- ‚úÖ ha-backup
- ‚úÖ nightly-reboot
- ‚úÖ update-checker
- ‚úÖ system-diagnostic-startup
- ‚úÖ boot-notifier

### Log Files

- `/var/log/ha-watchdog.log`
- `/var/log/ha-failure-notifier.log`
- `/var/log/telegram-sender.log`
- `/var/log/ha-backup.log`
- `/var/log/update-checker.log`
- `/var/log/system-diagnostic-startup.log`
- `/var/log/boot-notifier.log`
- `/var/log/ha-reboot.log`
- `/var/log/logging-service.log`
```

**–î–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ü–∏—é "Boot Notification System"**:

```markdown
## üîî Boot Notification System

Intelligent boot notification that distinguishes planned vs unplanned reboots.

### How It Works

**Planned Reboot (nightly-reboot at 03:30)**:
1. `nightly-reboot.sh` sends notification "üîÑ Nightly reboot starting..."
2. Creates marker file: `/var/lib/nightly-reboot/planned-reboot.marker`
3. System reboots
4. `boot-notifier.sh` runs 30s after boot
5. Detects recent marker (<5 min old)
6. Exits silently (no duplicate notification)

**Unplanned Reboot (crash, power loss, manual reboot)**:
1. No marker file exists (or >5 min old)
2. `boot-notifier.sh` detects unplanned reboot
3. Collects diagnostics:
   - Boot time and uptime
   - Load average
   - Memory usage
   - Disk usage
   - Kernel panic detection
   - Power supply issues
   - Last shutdown reason
4. Sends urgent notification with full diagnostics

### Result

- ‚úÖ Planned reboots: **1 notification** (before reboot)
- ‚ö†Ô∏è Unplanned reboots: **1 notification** (after boot with diagnostics)
- ‚ùå No duplicate notifications for scheduled maintenance

### Files

- `services/system/boot-notifier/boot-notifier.sh` - Detection script
- `services/system/boot-notifier/boot-notifier.service` - Systemd service
- `services/system/boot-notifier/boot-notifier.timer` - Runs 30s after boot
- `/var/lib/nightly-reboot/planned-reboot.marker` - Marker file
```

**–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–∏—Å–æ–≤**:
```markdown
## üîß Systemd Services

| Service | Schedule | Description |
|---------|----------|-------------|
| ha-watchdog.timer | Every 5 min | Health monitoring |
| ha-failure-notifier.timer | Every 1 min | Docker event monitoring |
| ha-backup.timer | Daily 02:00 | System backup |
| update-checker.timer | Mon-Fri 09:00 | Check for updates |
| system-diagnostic-startup.timer | Daily 05:30 | Morning diagnostic |
| nightly-reboot.timer | Daily 03:30 | Nightly system reboot |
| boot-notifier.timer | OnBootSec=30s | Boot notification |
```

#### 0.10.2 install_plan.md

**–î–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ü–∏—é "Prerequisites" (–ø–µ—Ä–µ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π —Å–µ—Ä–≤–∏—Å–æ–≤)**:

```markdown
## üîê Prerequisites: User Permissions

Before installing monitoring services, configure required permissions for user `ag`.

### Docker Access

Add `ag` user to docker group:

```bash
sudo usermod -aG docker ag
```

Verify:
```bash
groups ag | grep docker
# Output should include: docker
```

### Fail2ban Access

Create sudoers file for fail2ban-client:

```bash
sudo tee /etc/sudoers.d/ag-fail2ban > /dev/null << 'EOF'
# Allow ag user to check fail2ban status without password
ag ALL=(ALL) NOPASSWD: /usr/bin/fail2ban-client status*
EOF

sudo chmod 0440 /etc/sudoers.d/ag-fail2ban
```

Verify:
```bash
sudo -u ag sudo fail2ban-client status
# Should show fail2ban status without password prompt
```

### Apply Changes

After adding to docker group, either:

**Option 1**: Restart services
```bash
sudo systemctl daemon-reload
sudo systemctl restart ha-watchdog.timer
sudo systemctl restart ha-failure-notifier.timer
```

**Option 2**: Re-login as ag user
```bash
su - ag
```
```

**–î–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ü–∏—é "Important: Systemd Timer Configuration"**:

```markdown
## ‚öôÔ∏è Important: Systemd Timer Configuration

### Calendar vs Interval Timers

**Calendar Timers** (OnCalendar):
- Run at specific times (e.g., "Daily 02:00")
- Should **NOT** run at boot
- Examples: backup, update-checker, diagnostic

**Interval Timers** (OnBootSec, OnUnitActiveSec):
- Run at intervals or after boot
- Should run at boot
- Examples: watchdog, failure-notifier, boot-notifier

### Configuration Rules

**‚úÖ DO for Calendar Timers**:
```ini
[Unit]
Description=Daily backup at 02:00

[Timer]
OnCalendar=*-*-* 02:00:00
Persistent=false              # Don't catch up missed runs

[Install]
WantedBy=timers.target
```

**‚ùå DON'T for Calendar Timers**:
```ini
[Unit]
Requires=service.service      # ‚ùå Causes boot-time execution

[Timer]
OnCalendar=*-*-* 02:00:00
Persistent=true               # ‚ùå Catch-up runs cause duplicates
RandomizedDelaySec=300        # ‚ùå Unnecessary for precise times
```

**‚úÖ DO for Interval Timers**:
```ini
[Unit]
Description=Boot notification
Requires=boot-notifier.service  # ‚úÖ Should run at boot

[Timer]
OnBootSec=30s                   # Run 30s after boot
AccuracySec=1s

[Install]
WantedBy=timers.target
```

### Why This Matters

**Problem**: `Requires=service.service` in calendar timer causes:
1. Timer activates at boot
2. `Requires` triggers service start
3. Service runs at boot (unwanted)
4. Service runs again at scheduled time (duplicate)

**Solution**: Remove `Requires=` from calendar timers.

### Verification After Installation

Check that calendar timers are inactive after boot:

```bash
# Should show "inactive" for calendar timers
systemctl status ha-backup.timer
systemctl status update-checker.timer
systemctl status system-diagnostic-startup.timer
systemctl status nightly-reboot.timer

# Should show "active" for interval timers
systemctl status ha-watchdog.timer
systemctl status ha-failure-notifier.timer
systemctl status boot-notifier.timer
```

Check next scheduled run:
```bash
systemctl list-timers --all
```

Calendar timers should show NEXT run at scheduled time, not immediately.
```

**–î–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ü–∏—é "Setup Boot Notifier"**:

```markdown
## üîî Setup Boot Notifier

Install boot notification system:

```bash
# Install files
sudo cp services/system/boot-notifier/boot-notifier.sh /usr/local/bin/
sudo chmod +x /usr/local/bin/boot-notifier.sh

sudo cp services/system/boot-notifier/boot-notifier.service /etc/systemd/system/
sudo cp services/system/boot-notifier/boot-notifier.timer /etc/systemd/system/

sudo cp services/system/boot-notifier/boot-notifier.logrotate /etc/logrotate.d/boot-notifier

# Create marker directory
sudo mkdir -p /var/lib/nightly-reboot
sudo chown ag:ag /var/lib/nightly-reboot

# Enable and start
sudo systemctl daemon-reload
sudo systemctl enable boot-notifier.timer
sudo systemctl start boot-notifier.timer

# Verify
systemctl status boot-notifier.timer
```

Test by rebooting:
```bash
sudo reboot
```

After reboot, check if notification was sent (should be silent for planned reboot).
```

**–ò—Å—Ç–æ—á–Ω–∏–∫**: –ö–æ–º–º–∏—Ç `4603bb8` –∏ `6fb7813`

---

### 0.11 –ü–æ—Ä—è–¥–æ–∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≠–¢–ê–ü–ê 0

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–ê–Ø –ü–û–°–õ–ï–î–û–í–ê–¢–ï–õ–¨–ù–û–°–¢–¨**:

1. ‚úÖ **–°–Ω–∞—á–∞–ª–∞**: 0.1 - –ò—Å–ø—Ä–∞–≤–∏—Ç—å logging-service.sh
2. ‚úÖ **–ó–∞—Ç–µ–º**: 0.4-0.5 - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ –≤—Å–µ —Å–∫—Ä–∏–ø—Ç—ã
3. ‚úÖ **–ó–∞—Ç–µ–º**: 0.2 - –ò—Å–ø—Ä–∞–≤–∏—Ç—å ha-watchdog.sh (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–≥–æ logging-service)
4. ‚úÖ **–ó–∞—Ç–µ–º**: 0.3 - –£–ª—É—á—à–∏—Ç—å ha-failure-notifier.sh
5. ‚úÖ **–ó–∞—Ç–µ–º**: 0.9 - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å permissions
6. ‚úÖ **–ó–∞—Ç–µ–º**: 0.6 - –ò—Å–ø—Ä–∞–≤–∏—Ç—å systemd timers
7. ‚úÖ **–ó–∞—Ç–µ–º**: 0.7 - –î–æ–±–∞–≤–∏—Ç—å Boot Notifier
8. ‚úÖ **–ó–∞—Ç–µ–º**: 0.8 - –û–±–Ω–æ–≤–∏—Ç—å ag-monitoring-control
9. ‚úÖ **–ü–æ—Å–ª–µ–¥–Ω–∏–º**: 0.10 - –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –≠–¢–ê–ü–ê 0**:
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å permissions
groups ag | grep docker
sudo -u ag sudo fail2ban-client status

# 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
sudo systemctl daemon-reload
ag-restart

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
ag-logs

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
ag-status

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å timers
systemctl list-timers --all

# 6. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å boot notifier
sudo reboot
# –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–µ –±—ã–ª–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–µ—Å–ª–∏ —ç—Ç–æ –±—ã–ª nightly reboot)
```

---

## üìä –°–≤–æ–¥–∫–∞ –≠–¢–ê–ü–ê 0

| # | –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–∏–ø | –§–∞–π–ª–æ–≤ | –ò—Å—Ç–æ—á–Ω–∏–∫ |
|---|-----------|-----|--------|----------|
| 0.1 | logging-service.sh fixes | üîß –ö—Ä–∏—Ç–∏—á–Ω–æ | 1 | 4603bb8 |
| 0.2 | ha-watchdog sudo fix | üîß –ö—Ä–∏—Ç–∏—á–Ω–æ | 1 | 4603bb8 |
| 0.3 | ha-failure-notifier improvements | üîß –ò–∑–º–µ–Ω–µ–Ω–∏–µ | 1 | 4603bb8 |
| 0.4-0.5 | Centralized logging integration | üîß –ò–∑–º–µ–Ω–µ–Ω–∏–µ | 6 | 4603bb8 |
| 0.6 | Systemd timer fixes | üîß –ö—Ä–∏—Ç–∏—á–Ω–æ | 4 | 6fb7813 |
| 0.7 | Boot notifier system | üÜï –ù–æ–≤–æ–µ | 4 | 6fb7813 |
| 0.8 | ag-monitoring-control update | üîß –ò–∑–º–µ–Ω–µ–Ω–∏–µ | 1 | 6fb7813 |
| 0.9 | Permissions setup | ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | 1 | 4603bb8 |
| 0.10 | Documentation | üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | 2 | 4603bb8, 6fb7813 |
| **–ò–¢–û–ì–û** | | | **21** | **2 –∫–æ–º–º–∏—Ç–∞** |

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≠–¢–ê–ü–ê 0**: ~3-4 —á–∞—Å–∞

---

## üìã –≠–¢–ê–ü 1: –ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º

### 1.1 –î–æ–±–∞–≤–∏—Ç—å ag-monitoring-control (—É–ø—Ä–∞–≤–ª—è—é—â–∏–π —Å–∫—Ä–∏–ø—Ç)

**–§–∞–π–ª—ã**:
```
HomeAssistant/services/management/
‚îú‚îÄ‚îÄ ag-monitoring-control.sh          # –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
‚îî‚îÄ‚îÄ ag-monitoring-control.logrotate   # –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤
```

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
- `ag-start` - –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- `ag-stop` - –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
- `ag-status` - –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- `ag-logs` - –ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- `sysdiag` - –±—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- `temp` - –ø–æ–∫–∞–∑–∞—Ç—å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞

**–ê–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª—è Dell Wyse**:
```bash
# –í ag-monitoring-control.sh –∏–∑–º–µ–Ω–∏—Ç—å:
- /root/AdGuard/         ‚Üí /root/HomeAssistant/
- vcgencmd measure_temp  ‚Üí sensors –∏–ª–∏ cat /sys/class/thermal/thermal_zone*/temp
```

**–ê–ª–∏–∞—Å—ã –¥–ª—è `.bashrc`**:
```bash
# HomeAssistant monitoring aliases
alias ag-start='/root/HomeAssistant/services/management/ag-monitoring-control.sh start'
alias ag-stop='/root/HomeAssistant/services/management/ag-monitoring-control.sh stop'
alias ag-status='/root/HomeAssistant/services/management/ag-monitoring-control.sh status'
alias ag-logs='/root/HomeAssistant/services/management/ag-monitoring-control.sh logs'
alias ag-restart='/root/HomeAssistant/services/management/ag-monitoring-control.sh restart'
alias sysdiag='/root/HomeAssistant/services/diagnostics/system-diagnostic.sh'
alias temp='sensors | grep -i core'
```

**–ò—Å—Ç–æ—á–Ω–∏–∫**: –ö–æ–º–º–∏—Ç `affe296` (5 –æ–∫—Ç, 19:08)

---

## üìã –≠–¢–ê–ü 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### 2.1 –û—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤ (—Ç–æ–ª—å–∫–æ timers)

**–ü—Ä–æ–±–ª–µ–º–∞**: –°–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—Å–∫–∞–ª–∏—Å—å –∏ –≤—Ä—É—á–Ω—É—é, –∏ –ø–æ —Ç–∞–π–º–µ—Ä—É ‚Üí –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–†–µ—à–µ–Ω–∏–µ**: –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å `WantedBy=multi-user.target` –≤ service —Ñ–∞–π–ª–∞—Ö

**–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è**:
```
services/system/ha-backup/ha-backup.service
services/system/update-checker/update-checker.service
services/system/system-diagnostic-startup/system-diagnostic-startup.service
```

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ**:
```ini
[Install]
# WantedBy=multi-user.target  # Disabled - run only via timer
```

**–ò—Å—Ç–æ—á–Ω–∏–∫**: –ö–æ–º–º–∏—Ç `565f067` (9 –æ–∫—Ç, 15:15)

---

### 2.2 –û—Ç–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ä–æ—Ç–∞—Ü–∏–∏ –ª–æ–≥–æ–≤

**–§–∞–π–ª—ã**:
```
services/management/ag-monitoring-control.logrotate
services/system/logging-service/logging-service.logrotate
```

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ**:
```
# –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å postrotate —Å–∫—Ä–∏–ø—Ç—ã —Å Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
```

**–ò—Å—Ç–æ—á–Ω–∏–∫**: –ö–æ–º–º–∏—Ç `565f067` (9 –æ–∫—Ç, 15:15)

---

### 2.3 –î–æ–±–∞–≤–∏—Ç—å —É–º–Ω–æ–µ –æ–∫–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è fail2ban

**–ü—Ä–æ–±–ª–µ–º–∞**: fail2ban –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è start/stop –ø—Ä–∏ –∫–∞–∂–¥–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ

**–†–µ—à–µ–Ω–∏–µ**: –ü–æ–¥–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –≤ –æ–∫–Ω–µ 03:20-03:40 (–≤—Ä–µ–º—è nightly-reboot)

**–§–∞–π–ª**: `services/security/fail2ban-telegram-notify/telegram-fail2ban-notify.sh`

**–î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é**:
```bash
# Function to check if current time is within reboot window (03:20 - 03:40)
is_reboot_window() {
    local current_hour=$(date '+%H')
    local current_minute=$(date '+%M')
    local current_time=$((current_hour * 60 + current_minute))
    
    # Reboot window: 03:20 - 03:40 (200 - 220 minutes from midnight)
    local reboot_start=200  # 03:20
    local reboot_end=220    # 03:40
    
    if [[ $current_time -ge $reboot_start && $current_time -le $reboot_end ]]; then
        return 0  # true - within reboot window
    else
        return 1  # false - outside reboot window
    fi
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
```bash
"start")
    if is_reboot_window; then
        log_message "Skip start notification - within scheduled reboot window"
    else
        "$TELEGRAM_SCRIPT" "üõ°Ô∏è Fail2Ban Security System Started..." "471"
    fi
    ;;
```

**–ò—Å—Ç–æ—á–Ω–∏–∫**: –ö–æ–º–º–∏—Ç `d8f9bf1` (9 –æ–∫—Ç, 15:26)

---

## üìã –≠–¢–ê–ü 3: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ —É–ª—É—á—à–µ–Ω–∏—è

### 3.1 –ò—Å–ø—Ä–∞–≤–∏—Ç—å broken pipe –æ—à–∏–±–∫–∏ –≤ watchdog

**–§–∞–π–ª**: `services/monitoring/ha-watchdog/ha-watchdog.sh`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
```bash
# –î–æ–±–∞–≤–∏—Ç—å 2>/dev/null –∫ –∫–æ–º–∞–Ω–¥–∞–º, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–∑—ã–≤–∞—é—Ç broken pipe
CPU_USAGE=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' 2>/dev/null)
TEMP=$(sensors | grep -i core | awk '{print $3}' 2>/dev/null)
```

**–ò—Å—Ç–æ—á–Ω–∏–∫**: –ö–æ–º–º–∏—Ç `4803547` (9 –æ–∫—Ç, 14:36)

---

### 3.2 –£–ª—É—á—à–∏—Ç—å logging-service –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

**–§–∞–π–ª**: `services/system/logging-service/logging-service.service`

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –æ–±–Ω–æ–≤–∏—Ç—å**:
- StandardOutput=journal
- StandardError=journal
- Restart=on-failure
- RestartSec=10s

**–ò—Å—Ç–æ—á–Ω–∏–∫**: –ö–æ–º–º–∏—Ç `4803547` (9 –æ–∫—Ç, 14:36)

---

## üìã –≠–¢–ê–ü 4: Cloudflare Tunnel –¥–ª—è —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ üÜï

### 4.1 –û–±–Ω–æ–≤–∏—Ç—å docker-compose.yml

**–¶–µ–ª—å**: –î–æ–±–∞–≤–∏—Ç—å Cloudflare Tunnel –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ HTTPS –¥–æ—Å—Ç—É–ø–∞ –∫ Home Assistant

**–§–∞–π–ª**: `docker/docker-compose.yml`

**–î–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã**:

```yaml
version: '3.8'

services:
  # ==================== HOME ASSISTANT ====================
  homeassistant:
    container_name: homeassistant
    image: ghcr.io/home-assistant/home-assistant:stable
    restart: unless-stopped
    privileged: true
    network_mode: host
    volumes:
      - /opt/homeassistant:/config
      - /etc/localtime:/etc/localtime:ro
    environment:
      - TZ=Europe/Kiev
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8123"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

  # ==================== NODE-RED ====================
  nodered:
    container_name: nodered
    image: nodered/node-red:latest
    restart: unless-stopped
    network_mode: host
    volumes:
      - /opt/nodered:/data
      - /etc/localtime:/etc/localtime:ro
    environment:
      - TZ=Europe/Kiev
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:1880"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

  # ==================== CLOUDFLARE TUNNEL ====================
  cloudflared-tunnel:
    container_name: cloudflared-tunnel
    image: cloudflare/cloudflared:latest
    restart: unless-stopped
    command: tunnel --no-autoupdate run --token ${CLOUDFLARE_TUNNEL_TOKEN}
    environment:
      - TUNNEL_TOKEN=${CLOUDFLARE_TUNNEL_TOKEN}
    depends_on:
      - homeassistant
    networks:
      - homeassistant-net

  # ==================== TEST WEB PAGE ====================
  test-web:
    container_name: test-web
    image: nginx:alpine
    restart: unless-stopped
    ports:
      - "8080:80"
    volumes:
      - ./test-web:/usr/share/nginx/html:ro
    networks:
      - homeassistant-net
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:80"]
      interval: 30s
      timeout: 5s
      retries: 3

networks:
  homeassistant-net:
    driver: bridge
```

**–°–æ–∑–¥–∞—Ç—å `.env` —Ñ–∞–π–ª**:
```bash
# docker/.env
CLOUDFLARE_TUNNEL_TOKEN=your_tunnel_token_here
```

**–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É**:
```html
<!-- docker/test-web/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home Assistant System - Test Page</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 600px;
            text-align: center;
        }
        h1 {
            color: #667eea;
            margin-bottom: 10px;
        }
        .status {
            color: #28a745;
            font-size: 24px;
            margin: 20px 0;
        }
        .info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        .info p {
            margin: 10px 0;
            text-align: left;
        }
        .link {
            display: inline-block;
            margin-top: 20px;
            padding: 12px 30px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: background 0.3s;
        }
        .link:hover {
            background: #764ba2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè† Home Assistant System</h1>
        <div class="status">‚úÖ Cloudflare Tunnel Active</div>
        <p>Your Home Assistant instance is securely accessible through Cloudflare Tunnel</p>
        
        <div class="info">
            <h3>System Information</h3>
            <p><strong>Host:</strong> Dell Wyse 3040</p>
            <p><strong>OS:</strong> Debian 12 (Bookworm) ARM64</p>
            <p><strong>Services:</strong> Home Assistant, Node-RED</p>
            <p><strong>Security:</strong> Cloudflare Zero Trust</p>
        </div>
        
        <a href="/home-assistant" class="link">Open Home Assistant ‚Üí</a>
    </div>
</body>
</html>
```

**–ò—Å—Ç–æ—á–Ω–∏–∫**: –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–æ –∏–∑ –∫–æ–º–º–∏—Ç–∞ `0c7ebca` (17 –æ–∫—Ç, 22:23)

---

### 4.2 –û–±–Ω–æ–≤–∏—Ç—å watchdog –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Cloudflare Tunnel

**–§–∞–π–ª**: `services/monitoring/ha-watchdog/ha-watchdog.conf`

**–ò–∑–º–µ–Ω–∏—Ç—å CONTAINERS**:
```bash
# Containers to monitor
CONTAINERS=("homeassistant" "nodered" "cloudflared-tunnel" "test-web")
```

**–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤ `ha-watchdog.sh`**:
```bash
# Check if Cloudflare Tunnel is accessible
check_cloudflare_tunnel() {
    if docker ps --format '{{.Names}}' | grep -q "cloudflared-tunnel"; then
        if docker inspect cloudflared-tunnel | grep -q '"Status": "running"'; then
            echo "OK"
        else
            echo "ERROR"
        fi
    else
        echo "NOT_FOUND"
    fi
}
```

**–ò—Å—Ç–æ—á–Ω–∏–∫**: –ö–æ–º–º–∏—Ç `0c7ebca` (17 –æ–∫—Ç, 22:23)

---

### 4.3 –û–±–Ω–æ–≤–∏—Ç—å system-diagnostic –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Docker

**–§–∞–π–ª**: `services/diagnostics/system-diagnostic.sh`

**–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏**:
```bash
# Check Cloudflare Tunnel status
check_cloudflare_tunnel() {
    local container="cloudflared-tunnel"
    
    if docker ps --format '{{.Names}}' | grep -q "$container"; then
        local status=$(docker inspect --format='{{.State.Status}}' "$container" 2>/dev/null)
        if [ "$status" = "running" ]; then
            log_check "PASS" "Cloudflare Tunnel" "Container running"
        else
            log_check "FAIL" "Cloudflare Tunnel" "Container status: $status"
        fi
    else
        log_check "FAIL" "Cloudflare Tunnel" "Container not found"
    fi
}

# Check Docker containers health
check_docker_health() {
    local containers=("homeassistant" "nodered" "cloudflared-tunnel" "test-web")
    
    for container in "${containers[@]}"; do
        if docker ps --format '{{.Names}}' | grep -q "^${container}$"; then
            local health=$(docker inspect --format='{{.State.Health.Status}}' "$container" 2>/dev/null)
            if [ "$health" = "healthy" ] || [ -z "$health" ]; then
                log_check "PASS" "Docker: $container" "Running and healthy"
            else
                log_check "WARN" "Docker: $container" "Health status: $health"
            fi
        else
            log_check "FAIL" "Docker: $container" "Container not found"
        fi
    done
}
```

**–ò—Å—Ç–æ—á–Ω–∏–∫**: –ö–æ–º–º–∏—Ç `0c7ebca` (17 –æ–∫—Ç, 22:23)

---

### 4.4 –û–±–Ω–æ–≤–∏—Ç—å backup –¥–ª—è Docker volumes

**–§–∞–π–ª**: `services/system/ha-backup/ha-backup.sh`

**–î–æ–±–∞–≤–∏—Ç—å –±—ç–∫–∞–ø Docker volumes**:
```bash
# Backup Docker volumes
backup_docker_volumes() {
    echo "Backing up Docker volumes..."
    
    # Home Assistant config
    if [ -d "/opt/homeassistant" ]; then
        tar -czf "$BACKUP_DIR/homeassistant-config.tar.gz" -C /opt homeassistant
    fi
    
    # Node-RED data
    if [ -d "/opt/nodered" ]; then
        tar -czf "$BACKUP_DIR/nodered-data.tar.gz" -C /opt nodered
    fi
    
    # Docker compose files
    if [ -d "/root/HomeAssistant/docker" ]; then
        tar -czf "$BACKUP_DIR/docker-configs.tar.gz" -C /root/HomeAssistant docker
    fi
}
```

**–ò—Å—Ç–æ—á–Ω–∏–∫**: –ö–æ–º–º–∏—Ç `0c7ebca` (17 –æ–∫—Ç, 22:23)

---

### 4.5 –û–±–Ω–æ–≤–∏—Ç—å update-checker –¥–ª—è Docker images

**–§–∞–π–ª**: `services/system/update-checker/update-checker.sh`

**–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π Docker images**:
```bash
# Check Docker images for updates
check_docker_updates() {
    local images=("ghcr.io/home-assistant/home-assistant:stable" "nodered/node-red:latest" "cloudflare/cloudflared:latest" "nginx:alpine")
    local updates_found=false
    
    for image in "${images[@]}"; do
        echo "Checking $image..."
        
        # Pull latest image info (without downloading)
        local local_digest=$(docker images --digests "$image" --format "{{.Digest}}" | head -1)
        local remote_digest=$(docker manifest inspect "$image" 2>/dev/null | jq -r '.config.digest' 2>/dev/null)
        
        if [ "$local_digest" != "$remote_digest" ] && [ -n "$remote_digest" ]; then
            echo "  ‚ö†Ô∏è  Update available: $image"
            updates_found=true
        else
            echo "  ‚úì Up to date: $image"
        fi
    done
    
    if [ "$updates_found" = true ]; then
        send_telegram_notification "üê≥ Docker updates available\n\nRun: docker-compose pull && docker-compose up -d"
    fi
}
```

**–ò—Å—Ç–æ—á–Ω–∏–∫**: –ö–æ–º–º–∏—Ç `0c7ebca` (17 –æ–∫—Ç, 22:23)

---

### 4.6 –ò—Å–ø—Ä–∞–≤–∏—Ç—å Docker health checks –∏ system diagnostics üîß

**–¶–µ–ª—å**: –£—Å—Ç—Ä–∞–Ω–∏—Ç—å warning'–∏ –≤ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å health checks –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

**–ò—Å—Ç–æ—á–Ω–∏–∫**: –ö–æ–º–º–∏—Ç `25f7a68` (17 –æ–∫—Ç, 23:11)

#### 4.6.1 –ò—Å–ø—Ä–∞–≤–∏—Ç—å docker-compose.yml health checks

**–§–∞–π–ª**: `docker/docker-compose.yml`

**–ü—Ä–æ–±–ª–µ–º–∞ 1**: cloudflared-tunnel health check –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (–Ω–µ—Ç pgrep/sh –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ)

**–†–µ—à–µ–Ω–∏–µ**: –£–¥–∞–ª–∏—Ç—å health check –¥–ª—è cloudflared-tunnel

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ**:
```yaml
# –ë–´–õ–û:
cloudflared-tunnel:
  image: cloudflare/cloudflared:latest
  # ...
  healthcheck:
    test: ["CMD", "cloudflared", "tunnel", "list"]
    interval: 30s
    timeout: 10s
    retries: 3
    start_period: 40s

# –°–¢–ê–õ–û:
cloudflared-tunnel:
  image: cloudflare/cloudflared:latest
  # ...
  # Note: cloudflared container has minimal tools, so we disable health check
  # The tunnel status is monitored through system diagnostics and logs
```

**–ü—Ä–æ–±–ª–µ–º–∞ 2**: Home Assistant health check –Ω–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—Ç—É –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**–í–ê–ñ–ù–û**: –≠—Ç–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Home Assistant. –î–ª—è –ø—Ä–æ–µ–∫—Ç–∞ HomeAssistant –ù–ï –ü–†–ò–ú–ï–ù–Ø–¢–¨, —Ç–∞–∫ –∫–∞–∫ —Ç–∞–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è AdGuard Home.

#### 4.6.2 –£–ª—É—á—à–∏—Ç—å system-diagnostic.sh

**–§–∞–π–ª**: `services/diagnostics/system-diagnostic.sh`

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ 1 - –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –¥–ª—è Raspberry Pi** (—Ñ—É–Ω–∫—Ü–∏—è `check_temperature()`):

```bash
# –ë–´–õ–û:
TEMP=$(cat /sys/class/thermal/thermal_zone0/temp 2>/dev/null)

# –°–¢–ê–õ–û:
# Check all thermal zones (some systems use zone1 or zone2)
TEMP=""
for zone in /sys/class/thermal/thermal_zone*/temp; do
    if [[ -f "$zone" ]]; then
        TEMP=$(cat "$zone" 2>/dev/null)
        break
    fi
done

if [[ -z "$TEMP" ]]; then
    # Fallback to vcgencmd for Raspberry Pi
    TEMP=$(vcgencmd measure_temp 2>/dev/null | grep -oP '\d+\.\d+')
    if [[ -n "$TEMP" ]]; then
        TEMP=$(echo "$TEMP * 1000" | bc | cut -d. -f1)
    fi
fi
```

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ 2 - –°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å CPU performance thresholds –¥–ª—è ARM**:

```bash
# –ë–´–õ–û:
if (( $(echo "$cpu_time < 5" | bc -l) )); then
    log_check "PASS" "CPU Performance" "fast ($cpu_time seconds)"
elif (( $(echo "$cpu_time < 10" | bc -l) )); then
    log_check "PASS" "CPU Performance" "normal ($cpu_time seconds)"
else
    log_check "WARN" "CPU Performance" "slow ($cpu_time seconds)"
fi

# –°–¢–ê–õ–û:
# ARM processors are slower, adjust thresholds
if (( $(echo "$cpu_time < 10" | bc -l) )); then
    log_check "PASS" "CPU Performance" "fast for ARM ($cpu_time seconds)"
elif (( $(echo "$cpu_time < 15" | bc -l) )); then
    log_check "PASS" "CPU Performance" "normal for ARM ($cpu_time seconds)"
else
    log_check "WARN" "CPU Performance" "slow for ARM ($cpu_time seconds)"
fi
```

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ 3 - –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—É—Ç—å –∫ watchdog config**:

```bash
# –ë–´–õ–û:
if [[ -f "/etc/watchdog/config" ]]; then

# –°–¢–ê–õ–û:
if [[ -f "/etc/ha-watchdog/config" ]]; then
```

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ 4 - –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã—Ö Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤**:

```bash
# –û–±–Ω–æ–≤–∏—Ç—å –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç–µ–∫—É—â–∏–º docker-compose.yml
# –î–ª—è HomeAssistant –ø—Ä–æ–µ–∫—Ç–∞: homeassistant, nodered, cloudflared-tunnel, test-web
# –ò–ª–∏ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ AdGuard Home: adguard, cloudflared, test-web
```

#### 4.6.3 –£–ª—É—á—à–∏—Ç—å ha-watchdog.sh logging integration

**–§–∞–π–ª**: `services/monitoring/ha-watchdog/ha-watchdog.sh`

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ - –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ log_structured**:

```bash
# –ë–´–õ–û:
log_structured "WARN" "ha-watchdog" "$message"

# –°–¢–ê–õ–û:
log_structured "ha-watchdog" "WARN" "$message"
```

**–£–ª—É—á—à–µ–Ω–∏–µ - –£–¥–∞–ª–∏—Ç—å fallback logging**:

–ù–∞–π—Ç–∏ –∏ —É–¥–∞–ª–∏—Ç—å –±–ª–æ–∫–∏ —Å fallback –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º, –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ:

```bash
# –£–î–ê–õ–ò–¢–¨ fallback –ª–æ–≥–∏ —Ç–∏–ø–∞:
# if ! log_structured ...; then
#     echo "..." >> "$LOG_FILE"
# fi

# –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ:
log_structured "ha-watchdog" "INFO" "$message"
```

**–ê–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª—è Dell Wyse 3040**:
- –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ —É–∂–µ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è x86_64 (–±—É–¥—É—Ç –Ω–∏–∂–µ —á–µ–º –Ω–∞ ARM)
- CPU thresholds –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –¥–ª—è ARM (Dell Wyse 3040 –Ω–µ –æ—á–µ–Ω—å –º–æ—â–Ω—ã–π)

**–ò—Å—Ç–æ—á–Ω–∏–∫**: –ö–æ–º–º–∏—Ç `25f7a68` (17 –æ–∫—Ç, 23:11)

---

### 4.7 –î–æ–±–∞–≤–∏—Ç—å OAuth authentication –¥–ª—è Cloudflare Tunnel (–û–ü–¶–ò–û–ù–ê–õ–¨–ù–û) üÜï

**–¶–µ–ª—å**: –î–æ–±–∞–≤–∏—Ç—å –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é (OAuth + Basic Auth) –¥–ª—è –∑–∞—â–∏—Ç—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤

**–ò—Å—Ç–æ—á–Ω–∏–∫**: –ö–æ–º–º–∏—Ç `4910671` (19 –æ–∫—Ç, 07:44)

**‚ö†Ô∏è –í–ê–ñ–ù–û**: –≠—Ç–æ—Ç —ç—Ç–∞–ø –û–ü–¶–ò–û–ù–ê–õ–ï–ù. –ü—Ä–∏–º–µ–Ω—è–π—Ç–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞.

#### 4.7.1 –î–æ–±–∞–≤–∏—Ç—å nginx-proxy —Å Basic Auth

**–§–∞–π–ª**: `docker/docker-compose.yml`

**–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å** (–¥–ª—è AdGuard Home –∏–ª–∏ Home Assistant):

```yaml
services:
  # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–µ—Ä–≤–∏—Å—ã ...

  # –î–ª—è AdGuard Home:
  adguard-proxy:
    image: nginx:alpine
    container_name: adguard-proxy
    restart: unless-stopped
    volumes:
      - ./nginx-auth/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./nginx-auth/.htpasswd:/etc/nginx/.htpasswd:ro
      - ./nginx-auth/html:/usr/share/nginx/html:ro
    networks:
      - homeassistant-net  # –∏–ª–∏ adguard-net
    depends_on:
      - adguard  # –∏–ª–∏ homeassistant
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:8080/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

  # –î–ª—è Home Assistant (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ):
  homeassistant-proxy:
    image: nginx:alpine
    container_name: homeassistant-proxy
    restart: unless-stopped
    volumes:
      - ./nginx-auth/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./nginx-auth/.htpasswd:/etc/nginx/.htpasswd:ro
      - ./nginx-auth/html:/usr/share/nginx/html:ro
    networks:
      - homeassistant-net
    depends_on:
      - homeassistant
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:8080/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
```

**–û–±–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ cloudflared**:
```yaml
cloudflared-tunnel:
  # ...
  depends_on:
    - homeassistant  # –∏–ª–∏ adguard
    - homeassistant-proxy  # –∏–ª–∏ adguard-proxy
    - test-web
```

**–ò—Å–ø—Ä–∞–≤–∏—Ç—å health check –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞** (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è AdGuard Home):
```yaml
adguard:
  # ...
  healthcheck:
    test: ["CMD", "wget", "-q", "--spider", "http://localhost:80/"]  # –ò–∑–º–µ–Ω–µ–Ω–æ —Å 3000
    # –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: AdGuard Home –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è —Å –ø–æ—Ä—Ç–∞ 3000 –Ω–∞ 80 –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```

#### 4.7.2 –°–æ–∑–¥–∞—Ç—å nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

**–°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é**: `docker/nginx-auth/`

**–§–∞–π–ª 1**: `docker/nginx-auth/nginx.conf`

```nginx
events {
    worker_connections 1024;
}

http {
    upstream backend {
        server adguard:80;  # –∏–ª–∏ homeassistant:8123
    }

    server {
        listen 8080;
        server_name localhost;

        location / {
            auth_basic "Restricted Access";
            auth_basic_user_file /etc/nginx/.htpasswd;
            
            # Custom error page for authentication
            error_page 401 =401 /login.html;
            
            location = /login.html {
                root /usr/share/nginx/html;
                auth_basic off;
            }
            
            proxy_pass http://backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }
}
```

**–§–∞–π–ª 2**: `docker/nginx-auth/.htpasswd`

–°–æ–∑–¥–∞—Ç—å –ø–∞—Ä–æ–ª—å —Å –ø–æ–º–æ—â—å—é htpasswd:
```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è htpasswd —Ñ–∞–π–ª–∞
htpasswd -c docker/nginx-auth/.htpasswd user

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é (–ø—Ä–∏–º–µ—Ä):
echo 'user:$apr1$xyz...' > docker/nginx-auth/.htpasswd
```

**–§–∞–π–ª 3**: `docker/nginx-auth/html/login.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication Required</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }
        .login-container {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            max-width: 400px;
            text-align: center;
        }
        h1 {
            color: #667eea;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        input[type="text"],
        input[type="password"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
        }
        button {
            width: 100%;
            padding: 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
        }
        button:hover {
            background: #764ba2;
        }
        .message {
            color: #666;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="login-container">
        <h1>üîí Authentication Required</h1>
        <p class="message">Please enter your credentials to access the admin panel</p>
        <form id="loginForm">
            <div class="form-group">
                <label for="username">Username:</label>
                <input type="text" id="username" name="username" required>
            </div>
            <div class="form-group">
                <label for="password">Password:</label>
                <input type="password" id="password" name="password" required>
            </div>
            <button type="submit">Login</button>
        </form>
    </div>

    <script>
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Create basic auth header
            const credentials = btoa(username + ':' + password);
            
            // Redirect with auth header
            fetch('/', {
                headers: {
                    'Authorization': 'Basic ' + credentials
                }
            }).then(response => {
                if (response.ok) {
                    window.location.href = '/';
                } else {
                    alert('Invalid credentials. Please try again.');
                }
            }).catch(error => {
                console.error('Login error:', error);
                alert('Login error. Please try again.');
            });
        });
    </script>
</body>
</html>
```

#### 4.7.3 –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Cloudflare Access (OAuth)

**–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**: `docs/oauth-credentials.txt`

```
# Cloudflare Access OAuth Configuration
# –î–∞—Ç–∞: [—Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞]

TEAM NAME: [your-team-name]
ACCOUNT ID: [your-account-id]

## GitHub OAuth Application

Application Name: HomeAssistant CloudFlare Access
Homepage URL: https://[your-team-name].cloudflareaccess.com
Authorization callback URL: https://[your-team-name].cloudflareaccess.com/cdn-cgi/access/callback

Client ID: [your-github-client-id]
Client Secret: [your-github-client-secret]

## Google OAuth Application

Application Name: HomeAssistant CloudFlare
Authorized redirect URIs:
  - https://[your-team-name].cloudflareaccess.com/cdn-cgi/access/callback

Client ID: [your-google-client-id]
Client Secret: [your-google-client-secret]

## Cloudflare Access Application

Application Name: HomeAssistant Admin
Application Domain: admin.yourdomain.com
Policy: GitHub OAuth OR Google OAuth

## Credentials

Admin Username: user
Admin Password: [generated-password]
```

#### 4.7.4 –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

**–û–±–Ω–æ–≤–∏—Ç—å README.md** - –¥–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ü–∏—é:

```markdown
## üîê Authentication & Security

### Dual Authentication Flow

1. **Cloudflare Access (OAuth)** - First layer
   - GitHub OAuth integration
   - Google OAuth integration
   - Email-based access policies

2. **HTTP Basic Auth** - Second layer
   - nginx-proxy with htpasswd
   - Custom login page
   - Username/password protection

### Access Flow

```
User ‚Üí Cloudflare OAuth ‚Üí nginx Basic Auth ‚Üí Home Assistant/AdGuard
```

### Setup OAuth (Optional)

See detailed guide in `docs/install_plan.md` section 24.
```

**–û–±–Ω–æ–≤–∏—Ç—å install_plan.md** - –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Å–µ–∫—Ü–∏—é 24:

```markdown
## 24. Setup Cloudflare Access with OAuth (Optional)

### Prerequisites
- Cloudflare Zero Trust account
- GitHub and/or Google OAuth applications

### Step 1: Create GitHub OAuth App
1. Go to GitHub Settings ‚Üí Developer settings ‚Üí OAuth Apps
2. Click "New OAuth App"
3. Fill in:
   - Application name: HomeAssistant CloudFlare Access
   - Homepage URL: https://[team-name].cloudflareaccess.com
   - Callback URL: https://[team-name].cloudflareaccess.com/cdn-cgi/access/callback
4. Save Client ID and Client Secret

### Step 2: Create Google OAuth App
1. Go to Google Cloud Console
2. Create new project or select existing
3. Enable Google+ API
4. Create OAuth 2.0 credentials
5. Add authorized redirect URI: https://[team-name].cloudflareaccess.com/cdn-cgi/access/callback
6. Save Client ID and Client Secret

### Step 3: Configure Cloudflare Access
1. Go to Zero Trust dashboard
2. Settings ‚Üí Authentication
3. Add GitHub login method (Client ID + Secret)
4. Add Google login method (Client ID + Secret)
5. Create Access Application:
   - Application domain: admin.yourdomain.com
   - Policy: Allow GitHub OR Google users

### Step 4: Deploy nginx-proxy
```bash
cd /root/HomeAssistant/docker

# Generate htpasswd
htpasswd -c nginx-auth/.htpasswd user

# Update docker-compose.yml with proxy service
docker-compose up -d

# Verify
docker ps | grep proxy
```

### Step 5: Update Cloudflare Tunnel
Update public hostname to point to nginx-proxy:
- Hostname: admin.yourdomain.com
- Service: http://homeassistant-proxy:8080  # or adguard-proxy:8080

### Verification
1. Open https://admin.yourdomain.com
2. Should see Cloudflare OAuth screen
3. After OAuth, should see Basic Auth login form
4. Enter username/password
5. Access granted to admin panel
```

**–ê–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª—è HomeAssistant**:
- –í –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ nginx –∑–∞–º–µ–Ω–∏—Ç—å `adguard:80` –Ω–∞ `homeassistant:8123`
- –û–±–Ω–æ–≤–∏—Ç—å –∏–º–µ–Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—É—Ç–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

**–ò—Å—Ç–æ—á–Ω–∏–∫**: –ö–æ–º–º–∏—Ç `4910671` (19 –æ–∫—Ç, 07:44)

**‚ö†Ô∏è –ü–†–ò–ú–ï–ß–ê–ù–ò–ï**: –≠—Ç–æ—Ç —ç—Ç–∞–ø –º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å, –µ—Å–ª–∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è OAuth authentication. Basic Cloudflare Tunnel (–∏–∑ —ç—Ç–∞–ø–∞ 4.1-4.5) –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ —ç—Ç–æ–≥–æ.

---

## üìã –≠–¢–ê–ü 5: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### 5.1 –°–æ–∑–¥–∞—Ç—å docs/install_plan.md

**–ò—Å—Ç–æ—á–Ω–∏–∫**: –ö–æ–º–º–∏—Ç `7cbcccf` (5 –æ–∫—Ç, 15:27) + –∞–¥–∞–ø—Ç–∞—Ü–∏—è

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞** (21+ —Ä–∞–∑–¥–µ–ª–æ–≤):
1. System Requirements
2. Initial Debian Installation
3. Network Configuration
4. SSH Configuration
5. User Setup
6. SWAP Configuration
7. System Optimization
8. Security (UFW, fail2ban)
9. Docker Installation
10. **Cloudflare Tunnel Setup** üÜï
11. Home Assistant Installation
12. Node-RED Installation
13. Monitoring System Installation
14. Telegram Integration
15. Backup System
16. Update Checker
17. Nightly Reboot
18. Logging Service
19. Management Tools (ag-monitoring-control)
20. System Verification
21. Troubleshooting

**–ê–¥–∞–ø—Ç–∞—Ü–∏–∏ –¥–ª—è Dell Wyse 3040**:
- –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω—ã–µ –¥–∞—Ç—á–∏–∫–∏ (thermal_zone –≤–º–µ—Å—Ç–æ vcgencmd)
- Ethernet (eth0) –≤–º–µ—Å—Ç–æ WiFi (wlan0)
- x86_64 –ø–∞–∫–µ—Ç—ã –≤–º–µ—Å—Ç–æ ARM
- Dell-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

---

### 5.2 –û–±–Ω–æ–≤–∏—Ç—å README.md

**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
1. –î–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ü–∏—é –ø—Ä–æ Cloudflare Tunnel
2. –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
3. –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± ag-monitoring-control
4. –û–±–Ω–æ–≤–∏—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—É—é –¥–∏–∞–≥—Ä–∞–º–º—É
5. –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ troubleshooting

**–ù–æ–≤—ã–µ —Å–µ–∫—Ü–∏–∏**:
```markdown
## üåê Remote Access (Cloudflare Tunnel)

Secure HTTPS access to Home Assistant via Cloudflare Zero Trust:

- **Public URL**: https://homeassistant.your-domain.com
- **Test Page**: https://test.your-domain.com
- **Authentication**: Cloudflare Access (optional)
- **Zero port forwarding** - all traffic through encrypted tunnel

### Setup Cloudflare Tunnel

1. Create tunnel in Cloudflare dashboard
2. Add tunnel token to `docker/.env`
3. Configure public hostnames
4. Deploy: `cd docker && docker-compose up -d`

## üéÆ Management Commands

Quick access to monitoring system:

- `ag-start` - Start all monitoring services
- `ag-stop` - Stop all monitoring services  
- `ag-status` - Show status of all services
- `ag-logs` - View logs from all services
- `sysdiag` - Run full system diagnostic
- `temp` - Show CPU temperature
```

---

### 5.3 –°–æ–∑–¥–∞—Ç—å docs/cloudflare-tunnel-setup.md üÜï

**–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ**:
```markdown
# Cloudflare Tunnel Setup for Home Assistant

## Overview

Cloudflare Tunnel provides secure, encrypted access to Home Assistant without port forwarding.

## Prerequisites

- Cloudflare account with domain
- Docker installed
- Home Assistant running

## Step-by-Step Setup

### 1. Create Tunnel in Cloudflare Dashboard

1. Go to Zero Trust dashboard
2. Navigate to Networks > Tunnels
3. Create a tunnel, name it "homeassistant"
4. Copy the tunnel token

### 2. Configure Environment

Create `docker/.env`:
```bash
CLOUDFLARE_TUNNEL_TOKEN=your_token_here
```

### 3. Configure Public Hostnames

In Cloudflare dashboard, add public hostnames:

| Hostname | Service | URL |
|----------|---------|-----|
| homeassistant.yourdomain.com | http://homeassistant:8123 | Home Assistant |
| test.yourdomain.com | http://test-web:80 | Test page |

### 4. Deploy Containers

```bash
cd /root/HomeAssistant/docker
docker-compose pull
docker-compose up -d
```

### 5. Verify Access

- Test page: https://test.yourdomain.com
- Home Assistant: https://homeassistant.yourdomain.com

## Troubleshooting

### Tunnel not connecting

Check logs:
```bash
docker logs cloudflared-tunnel
```

### 502 Bad Gateway

Verify Home Assistant is running:
```bash
docker ps | grep homeassistant
curl http://localhost:8123
```

## Security

### Add Cloudflare Access (Optional)

1. Go to Zero Trust > Access > Applications
2. Create application for homeassistant.yourdomain.com
3. Add authentication rules (email, GitHub, Google)
4. Require authentication before tunnel access
```

---

### 5.4 –î–æ–±–∞–≤–∏—Ç—å docs/troubleshooting.md

**–ò—Å—Ç–æ—á–Ω–∏–∫**: –ö–æ–º–º–∏—Ç `398c900` (9 –æ–∫—Ç, 14:32)

**–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ**:
```markdown
# Troubleshooting Guide

## Common Issues

### 1. Duplicate SWAP entries in fstab

**Problem**: Multiple SWAP entries causing boot issues

**Solution**:
```bash
sudo swapoff -a
sudo nano /etc/fstab
# Remove duplicate /swapfile lines, keep only one
sudo swapon -a
```

### 2. ha-watchdog broken pipe errors

**Problem**: Broken pipe errors in logs

**Solution**: Already fixed in latest version (commands have 2>/dev/null)

### 3. Telegram notifications not working

**Problem**: No notifications received

**Diagnostics**:
```bash
# Test telegram-sender
/usr/local/bin/telegram-sender.sh "Test message" "0"

# Check logs
journalctl -u ha-watchdog -f
tail -f /var/log/ha-watchdog.log
```

### 4. Docker containers not starting

**Problem**: Containers exit immediately

**Solution**:
```bash
# Check logs
docker logs homeassistant
docker logs cloudflared-tunnel

# Restart Docker
sudo systemctl restart docker
docker-compose up -d
```

### 5. Cloudflare Tunnel 502 error

**Problem**: 502 Bad Gateway when accessing via tunnel

**Causes**:
- Home Assistant not running
- Wrong port in tunnel config
- Network connectivity issue

**Solution**:
```bash
# Verify HA is accessible locally
curl http://localhost:8123

# Restart tunnel
docker restart cloudflared-tunnel

# Check tunnel logs
docker logs cloudflared-tunnel
```
```

---

## üìã –≠–¢–ê–ü 6: –§–∏–Ω–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 6.1 –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ —Å–∏—Å—Ç–µ–º—É

**–°–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏** (—Å–æ–∑–¥–∞—Ç—å `install.sh`):
```bash
#!/bin/bash

# Install all updated services and configurations

set -e

echo "=== HomeAssistant Monitoring System Update ==="
echo ""

# 1. Install ag-monitoring-control
echo "Installing management tools..."
./services/management/install.sh

# 2. Update all service files
echo "Updating service configurations..."
for service_dir in services/monitoring/* services/system/* services/security/*; do
    if [ -f "$service_dir/install.sh" ]; then
        echo "  - $(basename $service_dir)"
        cd "$service_dir" && ./install.sh && cd -
    fi
done

# 3. Install aliases
echo "Installing bash aliases..."
cat >> ~/.bashrc << 'EOF'

# HomeAssistant monitoring aliases
alias ag-start='/root/HomeAssistant/services/management/ag-monitoring-control.sh start'
alias ag-stop='/root/HomeAssistant/services/management/ag-monitoring-control.sh stop'
alias ag-status='/root/HomeAssistant/services/management/ag-monitoring-control.sh status'
alias ag-logs='/root/HomeAssistant/services/management/ag-monitoring-control.sh logs'
alias sysdiag='/root/HomeAssistant/services/diagnostics/system-diagnostic.sh'
alias temp='sensors | grep -i core'
EOF

source ~/.bashrc

# 4. Deploy Docker stack
echo "Deploying Docker containers..."
cd docker
docker-compose pull
docker-compose up -d

echo ""
echo "=== Installation Complete ==="
echo ""
echo "Next steps:"
echo "1. Configure Cloudflare Tunnel token in docker/.env"
echo "2. Run 'ag-status' to check services"
echo "3. Run 'sysdiag' to verify system health"
echo "4. Access Home Assistant: https://your-domain.com"
```

---

### 6.2 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

**–ß–µ–∫–ª–∏—Å—Ç**:
```
‚ñ° –í—Å–µ systemd —Å–µ—Ä–≤–∏—Å—ã –∞–∫—Ç–∏–≤–Ω—ã (ag-status)
‚ñ° Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã (docker ps)
‚ñ° Home Assistant –¥–æ—Å—Ç—É–ø–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ (http://localhost:8123)
‚ñ° Cloudflare Tunnel —Ä–∞–±–æ—Ç–∞–µ—Ç (docker logs cloudflared-tunnel)
‚ñ° –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —á–µ—Ä–µ–∑ tunnel
‚ñ° Home Assistant –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ tunnel
‚ñ° Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç
‚ñ° Watchdog –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
‚ñ° Backup –≤–∫–ª—é—á–∞–µ—Ç Docker volumes
‚ñ° System diagnostic –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
‚ñ° –ê–ª–∏–∞—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç (ag-start, ag-status, sysdiag, temp)
```

---

## üìä –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

| # | –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–∏–ø | –§–∞–π–ª–æ–≤ | –ò—Å—Ç–æ—á–Ω–∏–∫ | –î–∞—Ç–∞ |
|---|-----------|-----|--------|----------|------|
| **0** | **üî¥ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** | **üîß –ö—Ä–∏—Ç–∏—á–Ω–æ** | **21** | **4603bb8, 6fb7813** | **21 –æ–∫—Ç** |
| 0.1 | logging-service.sh fixes | üîß –ö—Ä–∏—Ç–∏—á–Ω–æ | 1 | 4603bb8 | 21 –æ–∫—Ç |
| 0.2 | ha-watchdog sudo fix | üîß –ö—Ä–∏—Ç–∏—á–Ω–æ | 1 | 4603bb8 | 21 –æ–∫—Ç |
| 0.3 | ha-failure-notifier improvements | üîß –ò–∑–º–µ–Ω–µ–Ω–∏–µ | 1 | 4603bb8 | 21 –æ–∫—Ç |
| 0.4-0.5 | Centralized logging integration | üîß –ò–∑–º–µ–Ω–µ–Ω–∏–µ | 6 | 4603bb8 | 21 –æ–∫—Ç |
| 0.6 | Systemd timer fixes | üîß –ö—Ä–∏—Ç–∏—á–Ω–æ | 4 | 6fb7813 | 21 –æ–∫—Ç |
| 0.7 | Boot notifier system | üÜï –ù–æ–≤–æ–µ | 4 | 6fb7813 | 21 –æ–∫—Ç |
| 0.8 | ag-monitoring-control update | üîß –ò–∑–º–µ–Ω–µ–Ω–∏–µ | 1 | 6fb7813 | 21 –æ–∫—Ç |
| 0.9 | Permissions setup | ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | 1 | 4603bb8 | 21 –æ–∫—Ç |
| 0.10 | Documentation (Stage 0) | üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | 2 | 4603bb8, 6fb7813 | 21 –æ–∫—Ç |
| **1** | **Management tools** | **üÜï –ù–æ–≤–æ–µ** | **2** | **affe296** | **5 –æ–∫—Ç** |
| **2** | **Service optimization** | **üîß –ò–∑–º–µ–Ω–µ–Ω–∏–µ** | **3** | **565f067** | **9 –æ–∫—Ç** |
| **3** | **Smart reboot window** | **üîß –ò–∑–º–µ–Ω–µ–Ω–∏–µ** | **1** | **d8f9bf1** | **9 –æ–∫—Ç** |
| **4** | **Broken pipe fixes** | **üîß –ò–∑–º–µ–Ω–µ–Ω–∏–µ** | **2** | **4803547** | **9 –æ–∫—Ç** |
| **5** | **Cloudflare Tunnel (base)** | **üÜï –ù–æ–≤–æ–µ** | **5+** | **0c7ebca** | **17 –æ–∫—Ç** |
| **5.1** | **üîß Docker health checks fixes** | **üîß –ò–∑–º–µ–Ω–µ–Ω–∏–µ** | **3** | **25f7a68** | **17 –æ–∫—Ç** |
| **5.2** | **OAuth authentication (optional)** | **üÜï –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ** | **4+** | **4910671** | **19 –æ–∫—Ç** |
| **6** | **Documentation (Stages 1-6)** | **üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** | **4** | **7cbcccf, 398c900** | **5-9 –æ–∫—Ç** |
| | | | | | |
| **–ò–¢–û–ì–û –≠–¢–ê–ü 0** | | | **21** | **2 –∫–æ–º–º–∏—Ç–∞** | **21 –æ–∫—Ç** |
| **–ò–¢–û–ì–û –≠–¢–ê–ü–´ 1-6** | | | **25+** | **11 –∫–æ–º–º–∏—Ç–æ–≤** | **5-19 –æ–∫—Ç** |
| **–í–°–ï–ì–û** | | | **46+** | **15 –∫–æ–º–º–∏—Ç–æ–≤** | **5-21 –æ–∫—Ç** |

---

## üìù –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–û–ë–ù–û–í–õ–Å–ù–ù–´–ô —Å —É—á—ë—Ç–æ–º –Ω–æ–≤—ã—Ö –∫–æ–º–º–∏—Ç–æ–≤)

### üî¥ –§–∞–∑–∞ 0: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø (3-4 —á–∞—Å–∞) ‚ö†Ô∏è –ü–ï–†–í–´–ú –î–ï–õ–û–ú!

**–ò—Å—Ç–æ—á–Ω–∏–∫**: –ö–æ–º–º–∏—Ç—ã 4603bb8 –∏ 6fb7813 (21 –æ–∫—Ç—è–±—Ä—è 2025)

1. ‚úÖ **0.1** - –ò—Å–ø—Ä–∞–≤–∏—Ç—å logging-service.sh (–∫–æ–ª–ª–∏–∑–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, wrapper-—Ñ—É–Ω–∫—Ü–∏–∏)
2. ‚úÖ **0.4-0.5** - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ 7 —Å–µ—Ä–≤–∏—Å–∞—Ö
3. ‚úÖ **0.2** - –ò—Å–ø—Ä–∞–≤–∏—Ç—å ha-watchdog.sh (–¥–æ–±–∞–≤–∏—Ç—å sudo –¥–ª—è fail2ban)
4. ‚úÖ **0.3** - –£–ª—É—á—à–∏—Ç—å ha-failure-notifier.sh (throttling, restart check)
5. ‚úÖ **0.9** - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å permissions (docker group, sudoers)
6. ‚úÖ **0.6** - –ò—Å–ø—Ä–∞–≤–∏—Ç—å systemd timers (4 —Ñ–∞–π–ª–∞)
7. ‚úÖ **0.7** - –î–æ–±–∞–≤–∏—Ç—å Boot Notifier (4 –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–∞)
8. ‚úÖ **0.8** - –û–±–Ω–æ–≤–∏—Ç—å ag-monitoring-control.sh
9. ‚úÖ **0.10** - –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é (README, install_plan)
10. ‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å ag-status, ag-logs, reboot

**–ö–†–ò–¢–ò–ß–ù–û**: –≠—Ç—É —Ñ–∞–∑—É –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ü–û–õ–ù–û–°–¢–¨–Æ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –∫ –§–∞–∑–µ 1!

---

### –§–∞–∑–∞ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (30 –º–∏–Ω)

1. ‚úÖ –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º—ã
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –§–∞–∑–∞ 0 –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç (ag-status)
3. ‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –§–∞–∑–∞ 2: –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (1 —á–∞—Å)

4. ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ag-monitoring-control (–≠–¢–ê–ü 1) - –µ—Å–ª–∏ –µ—â—ë –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
5. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∞–ª–∏–∞—Å—ã –≤ .bashrc

### –§–∞–∑–∞ 3: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (30 –º–∏–Ω)

6. ‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–≠–¢–ê–ü 2)
7. ‚úÖ –û—Ç–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ä–æ—Ç–∞—Ü–∏–∏ –ª–æ–≥–æ–≤
8. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —É–º–Ω–æ–µ –æ–∫–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è fail2ban (–≠–¢–ê–ü 2.3)

### –§–∞–∑–∞ 4: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (30 –º–∏–Ω)

9. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ broken pipe –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã (–≠–¢–ê–ü 3) - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –§–∞–∑—ã 0
10. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å logging-service –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

### –§–∞–∑–∞ 5: Cloudflare Tunnel (1.5 —á–∞—Å–∞)

11. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å docker-compose.yml (–≠–¢–ê–ü 4.1)
12. ‚úÖ –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É (–≠–¢–ê–ü 4.1)
13. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å watchdog –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Cloudflare (–≠–¢–ê–ü 4.2)
14. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å system-diagnostic –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Docker (–≠–¢–ê–ü 4.3)
15. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å backup –¥–ª—è Docker volumes (–≠–¢–ê–ü 4.4)
16. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å update-checker –¥–ª—è Docker images (–≠–¢–ê–ü 4.5)

### –§–∞–∑–∞ 6: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (1 —á–∞—Å)

17. ‚úÖ –°–æ–∑–¥–∞—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å install_plan.md (–≠–¢–ê–ü 5.1)
18. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å README.md (–≠–¢–ê–ü 5.2)
19. ‚úÖ –°–æ–∑–¥–∞—Ç—å cloudflare-tunnel-setup.md (–≠–¢–ê–ü 5.3)
20. ‚úÖ –°–æ–∑–¥–∞—Ç—å troubleshooting.md (–≠–¢–ê–ü 5.4)

### –§–∞–∑–∞ 7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (30 –º–∏–Ω)

21. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –ø—É–Ω–∫—Ç—ã —á–µ–∫–ª–∏—Å—Ç–∞ (–≠–¢–ê–ü 6.2)
22. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É (sysdiag)
23. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Cloudflare Tunnel
24. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Boot Notifier (–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞)
25. ‚úÖ –°–æ–∑–¥–∞—Ç—å –∫–æ–º–º–∏—Ç —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
26. ‚úÖ Push –≤ GitHub

---

## ‚è±Ô∏è –û–±—â–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–µ)

| –§–∞–∑–∞ | –í—Ä–µ–º—è | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|------|-------|-----------|
| **–§–∞–∑–∞ 0: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è** | **3-4 —á–∞—Å–∞** | **üî¥ –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–´–ô** |
| –§–∞–∑–∞ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ | 30 –º–∏–Ω | –í—ã—Å–æ–∫–∏–π |
| –§–∞–∑–∞ 2: –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è | 1 —á–∞—Å | –°—Ä–µ–¥–Ω–∏–π |
| –§–∞–∑–∞ 3: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ | 30 –º–∏–Ω | –°—Ä–µ–¥–Ω–∏–π |
| –§–∞–∑–∞ 4: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | 30 –º–∏–Ω | –°—Ä–µ–¥–Ω–∏–π |
| –§–∞–∑–∞ 5: Cloudflare Tunnel | 1.5 —á–∞—Å–∞ | –í—ã—Å–æ–∫–∏–π |
| –§–∞–∑–∞ 6: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | 1 —á–∞—Å | –°—Ä–µ–¥–Ω–∏–π |
| –§–∞–∑–∞ 7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | 30 –º–∏–Ω | –í—ã—Å–æ–∫–∏–π |
| **–ò–¢–û–ì–û** | **~8-9 —á–∞—Å–æ–≤** | |

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –ê–¥–∞–ø—Ç–∞—Ü–∏–∏ –ø–æ–¥ Dell Wyse 3040

1. **–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞**:
   - ‚ùå `vcgencmd measure_temp` (Raspberry Pi)
   - ‚úÖ `sensors | grep -i core` –∏–ª–∏ `/sys/class/thermal/thermal_zone*/temp`

2. **–°–µ—Ç–µ–≤–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**:
   - ‚ùå `wlan0` (WiFi –Ω–∞ RPi)
   - ‚úÖ `eth0` (Ethernet –Ω–∞ Dell Wyse)

3. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**:
   - ‚ùå ARM64 (Raspberry Pi)
   - ‚úÖ x86_64 (Dell Wyse)

4. **–ü—É—Ç–∏**:
   - ‚ùå `/root/AdGuard/`
   - ‚úÖ `/root/HomeAssistant/`

5. **Hostname**:
   - ‚ùå `AdGuard`
   - ‚úÖ `rpi3-20250711` –∏–ª–∏ –Ω–æ–≤–æ–µ –∏–º—è

---

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ (–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ)

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (–≠–¢–ê–ü 0):
‚úÖ **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–æ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö**  
‚úÖ **Systemd timers –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –¥–≤–∞–∂–¥—ã**  
‚úÖ **Boot Notifier —Ä–∞–∑–ª–∏—á–∞–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ/–Ω–µ–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏**  
‚úÖ **Permissions –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã (docker group, fail2ban sudoers)**  
‚úÖ **ha-watchdog –ø—Ä–æ–≤–µ—Ä—è–µ—Ç fail2ban –±–µ–∑ –æ—à–∏–±–æ–∫**  
‚úÖ **ha-failure-notifier —Å throttling –∏ –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞**

### –û–±—â–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (–≠–¢–ê–ü–´ 1-6):
‚úÖ **–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –æ—à–∏–±–æ–∫**  
‚úÖ **Cloudflare Tunnel –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∏–∑–≤–Ω–µ**  
‚úÖ **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç —Ç–æ–ª—å–∫–æ –≤–∞–∂–Ω—ã–µ (–±–µ–∑ —Å–ø–∞–º–∞)**  
‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–≤–∫–ª—é—á–∞—è Docker)**  
‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–ª–Ω–∞—è –∏ –∞–∫—Ç—É–∞–ª—å–Ω–∞—è**  
‚úÖ **–°–∏—Å—Ç–µ–º–∞ –ª–µ–≥–∫–æ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ ag-–∫–æ–º–∞–Ω–¥—ã**

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—Ö–∞:
```bash
# 1. –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∞–∫—Ç–∏–≤–Ω—ã
ag-status

# 2. –õ–æ–≥–∏ –±–µ–∑ –æ—à–∏–±–æ–∫
ag-logs

# 3. Timers –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
systemctl list-timers --all

# 4. Permissions —Ä–∞–±–æ—Ç–∞—é—Ç
groups ag | grep docker
sudo -u ag sudo fail2ban-client status

# 5. Boot notifier —Ä–∞–±–æ—Ç–∞–µ—Ç
# (—Å–¥–µ–ª–∞—Ç—å reboot –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–µ—Ç –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)

# 6. Cloudflare Tunnel —Ä–∞–±–æ—Ç–∞–µ—Ç
docker logs cloudflared-tunnel
curl https://your-domain.com

# 7. –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç
sysdiag
```

---

## üìö –°–ø—Ä–∞–≤–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π
ag-start          # –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
ag-stop           # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
ag-status         # –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
ag-logs           # –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
sysdiag           # –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
temp              # –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ CPU

# Docker
docker-compose ps                    # –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose logs -f               # –õ–æ–≥–∏ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker logs cloudflared-tunnel       # –õ–æ–≥–∏ —Ç—É–Ω–Ω–µ–ª—è
docker-compose restart               # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
journalctl -u ha-watchdog -f        # –õ–æ–≥–∏ watchdog
journalctl -u ha-failure-notifier -f # –õ–æ–≥–∏ failure notifier
tail -f /var/log/ha-watchdog.log    # –§–∞–π–ª–æ–≤—ã–µ –ª–æ–≥–∏
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

```
HomeAssistant/
‚îú‚îÄ‚îÄ README.md                          # ‚úèÔ∏è –û–±–Ω–æ–≤–ª–µ–Ω
‚îú‚îÄ‚îÄ docker/
‚îÇ   ‚îú‚îÄ‚îÄ docker-compose.yml             # ‚úèÔ∏è Cloudflare Tunnel –¥–æ–±–∞–≤–ª–µ–Ω
‚îÇ   ‚îú‚îÄ‚îÄ .env                           # üÜï Tunnel token
‚îÇ   ‚îî‚îÄ‚îÄ test-web/
‚îÇ       ‚îî‚îÄ‚îÄ index.html                 # üÜï –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îú‚îÄ‚îÄ install_plan.md                # üÜï –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ cloudflare-tunnel-setup.md     # üÜï –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç—É–Ω–Ω–µ–ª—è
‚îÇ   ‚îú‚îÄ‚îÄ troubleshooting.md             # üÜï –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º
‚îÇ   ‚îî‚îÄ‚îÄ network-infrastructure.md      # ‚úèÔ∏è –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ö–µ–º–∞
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ management/                    # üÜï –ù–æ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ag-monitoring-control.sh   # ‚úèÔ∏è –û–±–Ω–æ–≤–ª—ë–Ω (boot-notifier)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ag-monitoring-control.logrotate
‚îÇ   ‚îú‚îÄ‚îÄ communication/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ telegram-sender/           # ‚úèÔ∏è –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ monitoring/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ha-watchdog/               # ‚úèÔ∏è Cloudflare + sudo + –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ha-failure-notifier/       # ‚úèÔ∏è Throttling + restart check
‚îÇ   ‚îú‚îÄ‚îÄ diagnostics/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ system-diagnostic.sh       # ‚úèÔ∏è Docker –ø—Ä–æ–≤–µ—Ä–∫–∏ + –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ security/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ fail2ban-telegram-notify/  # ‚úèÔ∏è Smart reboot window
‚îÇ   ‚îú‚îÄ‚îÄ system/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logging-service/           # ‚úèÔ∏è –ö–†–ò–¢–ò–ß–ù–û: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –±–∞–≥–∏, wrapper-—Ñ—É–Ω–∫—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ boot-notifier/             # üÜï –ù–û–í–û–ï: —É–º–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–≥—Ä—É–∑–∫–µ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ha-backup/                 # ‚úèÔ∏è Docker volumes + –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ update-checker/            # ‚úèÔ∏è Docker images + –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ nightly-reboot/            # ‚úèÔ∏è –ú–∞—Ä–∫–µ—Ä –¥–ª—è boot-notifier
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ system-diagnostic-startup/ # ‚úèÔ∏è –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ MIGRATION_PLAN.md                  # üìã –≠—Ç–æ—Ç —Ñ–∞–π–ª (–æ–±–Ω–æ–≤–ª—ë–Ω 21 –æ–∫—Ç)
```

---

## ‚úÖ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é

–≠—Ç–æ—Ç –ø–ª–∞–Ω –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—é –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç **–í–°–ï 15 –∫–æ–º–º–∏—Ç–æ–≤** (5-21 –æ–∫—Ç—è–±—Ä—è 2025).

### –ß—Ç–æ –≤–∫–ª—é—á–µ–Ω–æ:

**–≠–¢–ê–ü 0 (21 –æ–∫—Ç—è–±—Ä—è, 2 –∫–æ–º–º–∏—Ç–∞)** - –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è logging-service.sh (–∫–æ–ª–ª–∏–∑–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, wrapper-—Ñ—É–Ω–∫—Ü–∏–∏)
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ 7 —Å–µ—Ä–≤–∏—Å–∞—Ö
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ systemd timer –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (4 —Ñ–∞–π–ª–∞)
- ‚úÖ Boot Notification System (4 –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–∞)
- ‚úÖ Permissions setup (docker group, fail2ban sudoers)
- ‚úÖ ha-watchdog –∏ ha-failure-notifier —É–ª—É—á—à–µ–Ω–∏—è

**–≠–¢–ê–ü–´ 1-6 (5-19 –æ–∫—Ç—è–±—Ä—è, 13 –∫–æ–º–º–∏—Ç–æ–≤)** - –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–¨:
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è ag-monitoring-control
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚úÖ Cloudflare Tunnel –¥–ª—è —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ (–±–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
- ‚úÖ Docker health checks –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, CPU, watchdog logging)
- ‚úÖ OAuth authentication –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- ‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (4 —Ñ–∞–π–ª–∞)

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| **–í—Å–µ–≥–æ –∫–æ–º–º–∏—Ç–æ–≤** | 11 |
| **–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ** | 46+ |
| **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –±–∞–≥–æ–≤ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ** | 4 |
| **–ù–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º** | 4 (ag-control, boot-notifier, cloudflare, oauth) |
| **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Ñ–∏—á** | 1 (OAuth authentication) |
| **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è** | 8-10 —á–∞—Å–æ–≤ |
| **–†–∏—Å–∫–∏** | –ù–∏–∑–∫–∏–µ |

### –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:

‚úÖ **–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã** –Ω–∞ AdGuard –ø—Ä–æ–µ–∫—Ç–µ  
‚úÖ **100% —Å–æ–≤–º–µ—Å—Ç–∏–º–æ** —Å Dell Wyse 3040 (x86_64)  
‚úÖ **Rollback –≤–æ–∑–º–æ–∂–µ–Ω** —á–µ—Ä–µ–∑ git –∏ backup  
‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–ª–Ω–∞—è** —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏ –∫–æ–º–∞–Ω–¥–∞–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏  
‚úÖ **–£—á—Ç–µ–Ω—ã –í–°–ï –∫–æ–º–º–∏—Ç—ã** —Å 5 –ø–æ 21 –æ–∫—Ç—è–±—Ä—è 2025

### –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è –¥–ª—è –∞–≥–µ–Ω—Ç–∞:

‚ö†Ô∏è **–ö–æ–º–º–∏—Ç 25f7a68**: –ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç health checks –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É - –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ø—Ä–∏–º–µ–Ω–∏—Ç—å –ø–æ—Å–ª–µ –±–∞–∑–æ–≤–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Cloudflare Tunnel

‚ö†Ô∏è **–ö–æ–º–º–∏—Ç 4910671**: OAuth authentication - –û–ü–¶–ò–û–ù–ê–õ–¨–ù–û, –ø—Ä–∏–º–µ–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞

‚ö†Ô∏è **–ê–¥–∞–ø—Ç–∞—Ü–∏—è**: –ú–Ω–æ–≥–∏–µ –ø—Ä–∏–º–µ—Ä—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç AdGuard Home, –Ω–æ –ø–ª–∞–Ω –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω –¥–ª—è Home Assistant - —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –ø–æ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏

---

*–ü–ª–∞–Ω —Å–æ–∑–¥–∞–Ω: 19 –æ–∫—Ç—è–±—Ä—è 2025*  
*–û–±–Ω–æ–≤–ª—ë–Ω: 21 –æ–∫—Ç—è–±—Ä—è 2025 (—Ñ–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è)*  
*–ê–≤—Ç–æ—Ä: GitHub Copilot*  
*–í–µ—Ä—Å–∏—è: 2.1 - –í–∫–ª—é—á–µ–Ω—ã –í–°–ï 15 –∫–æ–º–º–∏—Ç–æ–≤ (4603bb8, 6fb7813, 25f7a68, 4910671 –∏ –¥—Ä—É–≥–∏–µ)*
